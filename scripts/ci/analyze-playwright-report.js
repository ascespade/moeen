#!/usr/bin/env node
const fs=require('fs'); const p=process.argv[2]; if(!p||!fs.existsSync(p)){process.exit(0);} const d=JSON.parse(fs.readFileSync(p,'utf8')); let total=0,passed=0,failed=0,failures=[]; function walk(s){if(s.tests){for(const t of s.tests){total++; if(t.status==='passed')passed++; else {failed++; failures.push({title:t.title,error:t.error});}}} if(s.suites)for(const ss of s.suites)walk(ss);} if(Array.isArray(d.suites)) for(const s of d.suites) walk(s); const percent=total?Math.round(passed*100/total):100; const out={total,passed,failed,percent,failures}; const outPath=require('path').join(require('path').dirname(p),'analysis.json'); fs.writeFileSync(outPath,JSON.stringify(out,null,2));
