# Server Optimization Commands
# Run these commands on the remote server (ubuntu@100.64.64.33)

# 1. Update system
sudo apt update && sudo apt upgrade -y

# 2. Install essential tools
sudo apt install -y curl wget git vim nano htop tree unzip zip jq build-essential

# 3. Install Node.js
curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -
sudo apt-get install -y nodejs

# 4. Install Python
sudo apt install -y python3 python3-pip python3-venv

# 5. Install Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker ubuntu
rm get-docker.sh

# 6. Install Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# 7. Configure SSH for better performance
sudo tee -a /etc/ssh/sshd_config > /dev/null << 'EOF'

# Performance optimizations
TCPKeepAlive yes
ClientAliveInterval 30
ClientAliveCountMax 6
MaxSessions 20
MaxStartups 20:30:100
EOF

sudo systemctl restart sshd

# 8. Create development workspace
mkdir -p ~/workspace ~/projects ~/scripts

# 9. Set up useful aliases
cat >> ~/.bashrc << 'EOF'

# Development aliases
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'
alias ..='cd ..'
alias ...='cd ../..'
alias grep='grep --color=auto'
alias h='history'
alias c='clear'

# Git aliases
alias gs='git status'
alias ga='git add'
alias gc='git commit'
alias gp='git push'
alias gl='git log --oneline'

# Docker aliases
alias d='docker'
alias dc='docker-compose'
alias dps='docker ps'
alias dpa='docker ps -a'

# Development shortcuts
alias dev='cd ~/workspace'
alias proj='cd ~/projects'
alias scripts='cd ~/scripts'
EOF

# 10. Install global npm packages
npm install -g nodemon pm2 typescript ts-node @types/node eslint prettier

# 11. Set up PM2
pm2 startup
pm2 save

# 12. Ensure Tailscale runs as service
sudo systemctl enable tailscaled
sudo systemctl start tailscaled

# 13. Create monitoring script
cat > ~/scripts/monitor.sh << 'EOF'
#!/bin/bash
echo "=== Server Status ==="
echo "Date: $(date)"
echo "Uptime: $(uptime)"
echo "Memory:"
free -h
echo "Disk:"
df -h
echo "CPU:"
top -bn1 | grep "Cpu(s)"
echo "Services:"
systemctl is-active ssh tailscaled docker
EOF

chmod +x ~/scripts/monitor.sh

# 14. Reload bashrc
source ~/.bashrc

echo "Server optimization complete!"
echo "Please reconnect to apply all changes"
