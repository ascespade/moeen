name: ðŸ¤– CI Assistant - Self-Healing Error Resolver

on:
  workflow_run:
    workflows: ["ðŸš€ Ultimate CI Self-Healing Agent"]
    types: [completed]
    branches: [main, develop, feature/*, hotfix/*, ai-auto-fixes/*]

permissions:
  contents: write
  pull-requests: write
  issues: write
  checks: write
  statuses: write
  actions: read

env:
  NODE_VERSION: '20'
  NPM_VERSION: '10'
  CI: true
  NODE_ENV: production

jobs:
  analyze-and-fix:
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: ðŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: ðŸ“¦ Ø¥Ø¹Ø¯Ø§Ø¯ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ðŸ“¥ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        run: |
          npm ci
          npm install js-yaml
          npx playwright install --with-deps chromium

      - name: ðŸ” ØªØ­Ù„ÙŠÙ„ Ø®Ø·Ø£ Ø§Ù„Ù€ Self-Healing
        id: analyze-error
        run: |
          echo "ðŸ” ØªØ­Ù„ÙŠÙ„ Ø®Ø·Ø£ Ø§Ù„Ù€ Self-Healing..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„
          mkdir -p analysis/ learning/ logs/
          
          # ØªØ­Ù„ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
          node -e "
            const fs = require('fs');
            const path = require('path');
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ù„Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
            class ErrorAnalyzer {
              constructor() {
                this.errors = [];
                this.learningData = this.loadLearningData();
                this.solutions = this.loadSolutions();
              }
              
              loadLearningData() {
                try {
                  return JSON.parse(fs.readFileSync('learning/error-patterns.json', 'utf8'));
                } catch {
                  return {};
                }
              }
              
              loadSolutions() {
                try {
                  return JSON.parse(fs.readFileSync('learning/known-solutions.json', 'utf8'));
                } catch {
                  return {};
                }
              }
              
              analyzeWorkflowError() {
                console.log('ðŸ” ØªØ­Ù„ÙŠÙ„ Ø®Ø·Ø£ Ø§Ù„Ù€ workflow...');
                
            // ØªØ­Ù„ÙŠÙ„ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù€ workflow ÙÙ‚Ø·
            const workflowErrors = [
              {
                pattern: 'YAML parsing error',
                solution: 'Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© YAML syntax ÙÙŠ Ø§Ù„Ù€ workflow',
                fix: 'fix-workflow-yaml'
              },
              {
                pattern: 'Invalid workflow',
                solution: 'Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© workflow syntax',
                fix: 'fix-workflow-syntax'
              },
              {
                pattern: 'Permission denied',
                solution: 'Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙÙŠ Ø§Ù„Ù€ workflow',
                fix: 'fix-workflow-permissions'
              },
              {
                pattern: 'Artifact not found',
                solution: 'Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù€ artifacts ÙÙŠ Ø§Ù„Ù€ workflow',
                fix: 'fix-workflow-artifacts'
              },
              {
                pattern: 'Timeout',
                solution: 'Ø²ÙŠØ§Ø¯Ø© timeout ÙÙŠ Ø§Ù„Ù€ workflow',
                fix: 'fix-workflow-timeout'
              }
            ];
                
                // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø£
                const errorType = this.detectErrorType();
                const error = workflowErrors.find(e => errorType.includes(e.pattern)) || {
                  pattern: 'Unknown',
                  solution: 'ØªØ­Ù„ÙŠÙ„ ÙŠØ¯ÙˆÙŠ Ù…Ø·Ù„ÙˆØ¨',
                  fix: 'manual-analysis'
                };
                
                console.log(\`ðŸŽ¯ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø£: \${error.pattern}\`);
                console.log(\`ðŸ’¡ Ø§Ù„Ø­Ù„: \${error.solution}\`);
                
                this.errors.push({
                  type: error.pattern,
                  solution: error.solution,
                  fix: error.fix,
                  timestamp: new Date().toISOString()
                });
                
                return error;
              }
              
              detectErrorType() {
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ù‚Ø±Ø§Ø¡Ø© Ø³Ø¬Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
                try {
                  const logFiles = [
                    'logs/error.log',
                    'logs/workflow-error.log',
                    '.github/workflows/ultimate-ci-self-healing.yml'
                  ];
                  
                  for (const file of logFiles) {
                    if (fs.existsSync(file)) {
                      const content = fs.readFileSync(file, 'utf8');
                      return content;
                    }
                  }
                } catch (e) {
                  console.log('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡');
                }
                
                return 'Unknown error';
              }
              
              saveAnalysis() {
                const analysis = {
                  timestamp: new Date().toISOString(),
                  errors: this.errors,
                  learningData: this.learningData,
                  solutions: this.solutions
                };
                
                fs.writeFileSync('analysis/error-analysis.json', JSON.stringify(analysis, null, 2));
                console.log('ðŸ’¾ ØªÙ… Ø­ÙØ¸ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡');
              }
            }
            
            const analyzer = new ErrorAnalyzer();
            const error = analyzer.analyzeWorkflowError();
            analyzer.saveAnalysis();
            
            // Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©
            console.log(\`::set-output name=error-type::\${error.pattern}\`);
            console.log(\`::set-output name=solution::\${error.solution}\`);
            console.log(\`::set-output name=fix-type::\${error.fix}\`);
          "

      - name: ðŸ¤– Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø®Ø·Ø£ Ø¥Ù„Ù‰ Cursor Background Agent
        run: |
          echo "ðŸ¤– Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø®Ø·Ø£ Ø¥Ù„Ù‰ Cursor Background Agent..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø®Ø·Ø£
          cat > error-report.json << 'EOF'
          {
            "error_type": "YAML syntax error",
            "file": ".github/workflows/ultimate-ci-self-healing.yml",
            "line": 493,
            "message": "Invalid workflow file: .github/workflows/ultimate-ci-self-healing.yml#L493 - You have an error in your yaml syntax on line 493",
            "context": "GitHub Actions workflow",
            "priority": "high",
            "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)"
          }
          EOF
          
          # Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Cursor Background Agent
          echo "ðŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø®Ø·Ø£ Ø¥Ù„Ù‰ Cursor Background Agent..."
          
          curl -X POST "https://api.cursor.sh/v1/background-agent" \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${{ vars.CURSOR_API_KEY }}" \
            -d @error-report.json \
            || echo "âš ï¸ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø®Ø·Ø£ Ø¥Ù„Ù‰ Cursor Background Agent"
          
          echo "ðŸ“„ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø®Ø·Ø£"
          echo "ðŸ¤– ÙŠØ±Ø¬Ù‰ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ù…Ù† Cursor Background Agent"
          
          # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ù…Ù† Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
          FIX_TYPE="${{ steps.analyze-error.outputs.fix-type }}"
          
          case "$FIX_TYPE" in
            "check-artifact-download")
              echo "ðŸ”§ Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ artifacts..."
              # Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù€ artifacts
              node -e "
                const fs = require('fs');
                const yaml = require('js-yaml');
                
                // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù€ workflow
                const workflowPath = '.github/workflows/ultimate-ci-self-healing.yml';
                let workflow = fs.readFileSync(workflowPath, 'utf8');
                
                // Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ Ù„Ù„Ù€ artifacts
                const artifactFix = \`
        - name: ðŸ“¥ ÙØ­Øµ Ø§Ù„Ù€ Artifacts
          run: |
            echo 'ðŸ” ÙØ­Øµ ØªÙˆÙØ± Ø§Ù„Ù€ artifacts...'
            if [ ! -d 'reports' ]; then
              echo 'ðŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ reports...'
              mkdir -p reports
              echo 'No reports available' > reports/no-reports.txt
            fi
            if [ ! -d 'logs' ]; then
              echo 'ðŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ logs...'
              mkdir -p logs
              echo 'No logs available' > logs/no-logs.txt
            fi
\`;
                
                // Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ù‚Ø¨Ù„ Ø®Ø·ÙˆØ© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ artifacts
                workflow = workflow.replace(
                  /(\s+)(- name: ðŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬)/,
                  \`\$1\$artifactFix\$1\$2\`
                );
                
                fs.writeFileSync(workflowPath, workflow);
                console.log('âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù€ artifacts');
              "
              ;;
              
            "fix-permissions")
              echo "ðŸ”§ Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª..."
              # Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
              node -e "
                const fs = require('fs');
                const yaml = require('js-yaml');
                
                const workflowPath = '.github/workflows/ultimate-ci-self-healing.yml';
                let workflow = fs.readFileSync(workflowPath, 'utf8');
                
                // Ø¥Ø¶Ø§ÙØ© permissions block Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                if (!workflow.includes('permissions:')) {
                  const permissionsBlock = \`
permissions:
  contents: write
  pull-requests: write
  issues: write
  checks: write
  statuses: write
  actions: read

\`;
                  workflow = workflow.replace(/^name:.*$/m, \`\$&\n\$permissionsBlock\`);
                }
                
                fs.writeFileSync(workflowPath, workflow);
                console.log('âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª');
              "
              ;;
              
            "fix-npm-install")
              echo "ðŸ”§ Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª..."
              # Ø¥ØµÙ„Ø§Ø­ npm install
              node -e "
                const fs = require('fs');
                const workflowPath = '.github/workflows/ultimate-ci-self-healing.yml';
                let workflow = fs.readFileSync(workflowPath, 'utf8');
                
                // ØªØ­Ø³ÙŠÙ† npm ci
                const npmFix = \`npm ci --cache .npm --prefer-offline || npm install\`;
                workflow = workflow.replace(/npm ci/g, npmFix);
                
                fs.writeFileSync(workflowPath, workflow);
                console.log('âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© npm install');
              "
              ;;
              
            "fix-playwright")
              echo "ðŸ”§ Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Playwright..."
              # Ø¥ØµÙ„Ø§Ø­ Playwright
              node -e "
                const fs = require('fs');
                const workflowPath = '.github/workflows/ultimate-ci-self-healing.yml';
                let workflow = fs.readFileSync(workflowPath, 'utf8');
                
                // ØªØ­Ø³ÙŠÙ† ØªØ«Ø¨ÙŠØª Playwright
                const playwrightFix = \`npx playwright install --with-deps chromium || npx playwright install chromium\`;
                workflow = workflow.replace(/npx playwright install --with-deps chromium/g, playwrightFix);
                
                fs.writeFileSync(workflowPath, workflow);
                console.log('âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Playwright');
              "
              ;;
              
            "fix-yaml-syntax")
              echo "ðŸ”§ Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© YAML syntax..."
              # Ø¥ØµÙ„Ø§Ø­ YAML
              node -e "
                const fs = require('fs');
                const yaml = require('js-yaml');
                
                try {
                  const workflowPath = '.github/workflows/ultimate-ci-self-healing.yml';
                  const content = fs.readFileSync(workflowPath, 'utf8');
                  
                  // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù„ÙŠÙ„ YAML
                  yaml.load(content);
                  console.log('âœ… YAML ØµØ­ÙŠØ­');
                } catch (error) {
                  console.log('âŒ Ø®Ø·Ø£ ÙÙŠ YAML:', error.message);
                  // Ø¥ØµÙ„Ø§Ø­ Ø¨Ø³ÙŠØ· Ù„Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
                  const content = fs.readFileSync('.github/workflows/ultimate-ci-self-healing.yml', 'utf8');
                  let fixed = content
                    .replace(/:\s*$/, ': ') // Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§ÙØ© Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ù‚Ø·ØªÙŠÙ†
                    .replace(/^(\s*)([a-zA-Z_][a-zA-Z0-9_]*):\s*$/, '$1$2: ') // Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§ÙØ© Ù„Ù„Ù‚ÙŠÙ… Ø§Ù„ÙØ§Ø±ØºØ©
                    .replace(/\n\s*\n\s*\n/g, '\n\n'); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„ÙØ§Ø±ØºØ© Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©
                  
                  fs.writeFileSync(workflowPath, fixed);
                  console.log('âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ YAML syntax');
                }
              "
              ;;
              
            "fix-json-syntax")
              echo "ðŸ”§ Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© JSON syntax..."
              # Ø¥ØµÙ„Ø§Ø­ JSON
              node -e "
                const fs = require('fs');
                
                // ÙØ­Øµ ÙˆØ¥ØµÙ„Ø§Ø­ package.json
                try {
                  const packagePath = 'package.json';
                  const content = fs.readFileSync(packagePath, 'utf8');
                  JSON.parse(content);
                  console.log('âœ… package.json ØµØ­ÙŠØ­');
                } catch (error) {
                  console.log('âŒ Ø®Ø·Ø£ ÙÙŠ package.json:', error.message);
                  
                  let fixed = content
                    .replace(/,(\s*[}\]])/g, '$1') // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙÙˆØ§ØµÙ„ Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©
                    .replace(/([{\[])\s*,\s*/g, '$1') // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙÙˆØ§ØµÙ„ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                    .replace(/\s*,\s*([}\]])/g, ' $1'); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙÙˆØ§ØµÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
                  
                  fs.writeFileSync('package.json', fixed);
                  console.log('âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ JSON syntax');
                }
              "
              ;;
              
            "fix-timeout")
              echo "ðŸ”§ Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Timeout..."
              # Ø¥ØµÙ„Ø§Ø­ Timeout
              node -e "
                const fs = require('fs');
                const workflowPath = '.github/workflows/ultimate-ci-self-healing.yml';
                let workflow = fs.readFileSync(workflowPath, 'utf8');
                
                // Ø²ÙŠØ§Ø¯Ø© timeout
                const timeoutFix = \`timeout-minutes: 60\`;
                workflow = workflow.replace(/timeout-minutes: \d+/g, timeoutFix);
                
                fs.writeFileSync(workflowPath, workflow);
                console.log('âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Timeout');
              "
              ;;
              
            *)
              echo "â“ Ù†ÙˆØ¹ Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ - ØªØ­Ù„ÙŠÙ„ ÙŠØ¯ÙˆÙŠ Ù…Ø·Ù„ÙˆØ¨"
              ;;
          esac

      - name: ðŸ§  Ø§Ù„ØªØ¹Ù„Ù… Ù…Ù† Ø§Ù„Ø®Ø·Ø£
        run: |
          echo "ðŸ§  Ø§Ù„ØªØ¹Ù„Ù… Ù…Ù† Ø§Ù„Ø®Ø·Ø£..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø§Ù„ØªØ¹Ù„Ù…
          mkdir -p learning/
          
          # Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®Ø·Ø£ Ù„Ù„ØªØ¹Ù„Ù…
          node -e "
            const fs = require('fs');
            
            const errorInfo = {
              timestamp: new Date().toISOString(),
              errorType: '${{ steps.analyze-error.outputs.error-type }}',
              solution: '${{ steps.analyze-error.outputs.solution }}',
              fixType: '${{ steps.analyze-error.outputs.fix-type }}',
              workflowRunId: '${{ github.event.workflow_run.id }}',
              branch: '${{ github.ref_name }}',
              commit: '${{ github.sha }}'
            };
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            let learningData = [];
            try {
              learningData = JSON.parse(fs.readFileSync('learning/error-history.json', 'utf8'));
            } catch {
              learningData = [];
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            learningData.push(errorInfo);
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
            fs.writeFileSync('learning/error-history.json', JSON.stringify(learningData, null, 2));
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
            const patterns = {};
            learningData.forEach(error => {
              const key = error.errorType;
              patterns[key] = (patterns[key] || 0) + 1;
            });
            
            fs.writeFileSync('learning/error-patterns.json', JSON.stringify(patterns, null, 2));
            
            console.log('ðŸ“š ØªÙ… Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®Ø·Ø£ Ù„Ù„ØªØ¹Ù„Ù…');
            console.log(\`ðŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©: \${learningData.length}\`);
          "

      - name: ðŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        run: |
          echo "ðŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª..."
          
          # ÙØ­Øµ Ø¥Ø¶Ø§ÙÙŠ Ù„Ù…Ù†Ø¹ Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ù…ÙØ±ØºØ©
          if [[ "${{ github.event.workflow_run.head_commit.message }}" == *"ðŸ¤– CI Assistant"* ]] || [[ "${{ github.event.workflow_run.head_commit.message }}" == *"CI Assistant"* ]]; then
            echo "âš ï¸ ØªÙ… Ù…Ù†Ø¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ù…ÙØ±ØºØ©"
            exit 0
          fi
          
          # Ø¥Ø¹Ø¯Ø§Ø¯ Git
          git config --local user.email "action@github.com"
          git config --local user.name "CI Assistant"
          
          # Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
          git add .
          
          # Ø¥Ù†Ø´Ø§Ø¡ commit Ù…Ø¹ Ø¹Ù„Ø§Ù…Ø© Ø®Ø§ØµØ©
          git commit -m "ðŸ¤– CI Assistant: Ø¥ØµÙ„Ø§Ø­ Ø®Ø·Ø£ ÙÙŠ Self-Healing

ðŸ”§ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª:
- Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø£: ${{ steps.analyze-error.outputs.error-type }}
- Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ø·Ø¨Ù‚: ${{ steps.analyze-error.outputs.solution }}
- Ù†ÙˆØ¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­: ${{ steps.analyze-error.outputs.fix-type }}

ðŸ“š Ø§Ù„ØªØ¹Ù„Ù…:
- ØªÙ… Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®Ø·Ø£ Ù„Ù„ØªØ¹Ù„Ù…
- ØªÙ… ØªØ­Ø¯ÙŠØ« Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
- ØªÙ… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù… Ù„ØªØ¬Ù†Ø¨ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø®Ø·Ø£

ðŸ¤– ØªÙ… Ø¨ÙˆØ§Ø³Ø·Ø©: CI Assistant
ðŸš« Ù…Ù†Ø¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø°Ø§ØªÙŠ: ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ù…Ø§ÙŠØ©" || echo "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª Ù„Ù„Ø­ÙØ¸"

      - name: ðŸ“¤ Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        run: |
          echo "ðŸ“¤ Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª..."
          git push origin ${{ github.ref_name }} || echo "ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª"

      - name: ðŸ“Š Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ØµÙ„Ø§Ø­
        run: |
          echo "ðŸ“Š Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ØµÙ„Ø§Ø­..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ±
          cat > reports/ci-assistant-report.md << 'EOF'
          # ðŸ¤– ØªÙ‚Ø±ÙŠØ± CI Assistant
          
          ## ðŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
          - **Ø§Ù„ÙˆÙ‚Øª:** $(date)
          - **Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø£:** ${{ steps.analyze-error.outputs.error-type }}
          - **Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ø·Ø¨Ù‚:** ${{ steps.analyze-error.outputs.solution }}
          - **Ù†ÙˆØ¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­:** ${{ steps.analyze-error.outputs.fix-type }}
          
          ## ðŸ”§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…ØªØ®Ø°Ø©
          1. ØªØ­Ù„ÙŠÙ„ Ø®Ø·Ø£ Ø§Ù„Ù€ Self-Healing workflow
          2. ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø£ ÙˆØ§Ù„Ø­Ù„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
          3. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
          4. Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®Ø·Ø£ Ù„Ù„ØªØ¹Ù„Ù…
          5. Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
          
          ## ðŸ“š Ø§Ù„ØªØ¹Ù„Ù…
          - ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø£ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ©
          - ØªÙ… ØªØ­Ø¯ÙŠØ« Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
          - Ø§Ù„Ù†Ø¸Ø§Ù… Ø³ÙŠØªØ¬Ù†Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„
          
          ## âœ… Ø§Ù„Ù†ØªÙŠØ¬Ø©
          ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª.
          EOF
          
          echo "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ØµÙ„Ø§Ø­"

      - name: ðŸ“¤ Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        uses: actions/upload-artifact@v4
        with:
          name: ci-assistant-report
          path: |
            reports/
            learning/
            analysis/
          retention-days: 30
