name: ðŸ¤– Cursor Manual Workflow

# âœ… ÙŠØ´ØªØºÙ„ ÙÙ‚Ø· Ù„Ù…Ø§ Ø£Ù†Øª ØªØ¨ØºØ§Ù‡ ÙŠØ´ØªØºÙ„
on:
  workflow_dispatch:
    inputs:
      mode:
        description: 'ÙˆØ´ ØªØ¨ØºÙ‰ ØªØ³ÙˆÙŠØŸ'
        required: true
        type: choice
        options:
          - 'test-only'           # ÙÙ‚Ø· ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
          - 'test-and-fix'        # Ø§Ø®ØªØ¨Ø§Ø± + Ø¥ØµÙ„Ø§Ø­ Ù„Ùˆ ÙÙŠÙ‡ Ù…Ø´Ø§ÙƒÙ„
          - 'test-fix-enhance'    # Ø§Ø®ØªØ¨Ø§Ø± + Ø¥ØµÙ„Ø§Ø­ + ØªØ­Ø³ÙŠÙ†
          - 'enhance-only'        # ÙÙ‚Ø· ØªØ­Ø³ÙŠÙ† (Ø¨Ø¯ÙˆÙ† Ø§Ø®ØªØ¨Ø§Ø±)
      
      stop_on_success:
        description: 'ØªÙˆÙ‚Ù Ù„Ùˆ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¬Ø­ØªØŸ'
        required: true
        type: boolean
        default: true
      
      model:
        description: 'Ø£ÙŠ Model ØªØ¨ØºÙ‰ ØªØ³ØªØ®Ø¯Ù…ØŸ'
        required: false
        type: choice
        default: 'claude-sonnet-4'
        options:
          - 'claude-sonnet-4'
          - 'gpt-4o'
          - 'gpt-4-turbo'

env:
  NODE_VERSION: '18'

jobs:
  # ==========================================
  # Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
  # ==========================================
  test:
    name: ðŸ§ª Run Tests
    if: |
      github.event.inputs.mode == 'test-only' ||
      github.event.inputs.mode == 'test-and-fix' ||
      github.event.inputs.mode == 'test-fix-enhance'
    runs-on: ubuntu-latest
    outputs:
      test_passed: ${{ steps.test.outcome == 'success' }}
      test_failed: ${{ steps.test.outcome == 'failure' }}
      should_continue: ${{ steps.check.outputs.should_continue }}
    
    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ðŸ“¦ Install Dependencies
        run: npm ci

      - name: ðŸŽ­ Install Playwright
        run: npx playwright install --with-deps

      - name: ðŸ§ª Run Tests
        id: test
        continue-on-error: true
        run: |
          echo "ðŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª..."
          npm test 2>&1 | tee test-output.log
          TEST_EXIT_CODE=$?
          echo "exit_code=$TEST_EXIT_CODE" >> $GITHUB_OUTPUT
          exit $TEST_EXIT_CODE

      - name: ðŸ“Š Test Results Summary
        if: always()
        run: |
          echo "## ðŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if [ "${{ steps.test.outcome }}" == "success" ]; then
            echo "âœ… **Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¬Ø­Øª!** ðŸŽ‰" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ **Ø¨Ø¹Ø¶ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙØ´Ù„Øª** ðŸ˜”" >> $GITHUB_STEP_SUMMARY
          fi
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“„ Log:" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          tail -50 test-output.log >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY

      - name: ðŸ›‘ Check if should stop
        id: check
        run: |
          STOP_ON_SUCCESS="${{ github.event.inputs.stop_on_success }}"
          TEST_PASSED="${{ steps.test.outcome == 'success' }}"
          
          if [ "$TEST_PASSED" == "true" ] && [ "$STOP_ON_SUCCESS" == "true" ]; then
            echo "âœ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¬Ø­Øª Ùˆ Ø£Ù†Øª Ø·Ù„Ø¨Øª Ø§Ù„ØªÙˆÙ‚Ù - Ø³Ø£ØªÙˆÙ‚Ù Ù‡Ù†Ø§"
            echo "should_continue=false" >> $GITHUB_OUTPUT
          else
            echo "should_continue=true" >> $GITHUB_OUTPUT
          fi

      - name: ðŸ“¤ Upload Test Results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-results
          path: |
            test-output.log
            test-results/
            playwright-report/
          retention-days: 7

  # ==========================================
  # Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
  # ==========================================
  fix:
    name: ðŸ”§ Auto-Fix
    needs: test
    # ÙŠØ´ØªØºÙ„ ÙÙ‚Ø· Ù„Ùˆ:
    # 1. Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙØ´Ù„Øª
    # 2. Ø§Ù„Ù€ mode ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ fix
    if: |
      needs.test.outputs.test_failed == 'true' &&
      (github.event.inputs.mode == 'test-and-fix' || 
       github.event.inputs.mode == 'test-fix-enhance')
    runs-on: ubuntu-latest
    outputs:
      fix_success: ${{ steps.verify.outcome == 'success' }}
    
    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ“¥ Download Test Logs
        uses: actions/download-artifact@v4
        with:
          name: test-results
          path: ./test-logs/

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ðŸ“¦ Install Dependencies
        run: npm ci

      - name: ðŸŽ­ Install Playwright
        run: npx playwright install --with-deps

      - name: ðŸš€ Install Cursor CLI
        run: |
          echo "ðŸš€ ØªØ«Ø¨ÙŠØª Cursor CLI..."
          curl https://cursor.com/install -fsS | bash
          echo "$HOME/.cursor/bin" >> $GITHUB_PATH

      - name: ðŸ¤– Run Fix Agent
        id: fix_agent
        env:
          CURSOR_API_KEY: ${{ secrets.CURSOR_API_KEY }}
        run: |
          echo "ðŸ¤– ØªØ´ØºÙŠÙ„ Cursor Agent Ù„Ù„Ø¥ØµÙ„Ø§Ø­..."
          
          cursor-agent -p "
          ðŸ”§ **Ø¥ØµÙ„Ø§Ø­ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Playwright Ø§Ù„ÙØ§Ø´Ù„Ø©**
          
          **Ø§Ù„Ø³ÙŠØ§Ù‚:**
          - Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø´ØºÙ„ Ø§Ù„Ù€ workflow ÙŠØ¯ÙˆÙŠØ§Ù‹
          - Model Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${{ github.event.inputs.model }}
          - Ù…Ù„ÙØ§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ./test-logs/
          
          **Ø§Ù„Ù…Ù‡Ù…Ø©:**
          1. Ø§ÙØªØ­ test-output.log ÙˆØ±Ø§Ø¬Ø¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
          2. Ø­Ø¯Ø¯ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (Ù„ÙŠØ³ ÙÙ‚Ø· Ø§Ù„Ø¹Ø±Ø¶)
          3. Ø£ØµÙ„Ø­ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ src/ Ø£Ùˆ tests/
          4. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ù†Ø·Ù‚ Ø³Ù„ÙŠÙ…
          
          **Ù…Ø´Ø§ÙƒÙ„ Playwright Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©:**
          - Selector Ù…Ø´ Ø´ØºØ§Ù„ â†’ Ø§Ø³ØªØ®Ø¯Ù… data-testid
          - Timeout â†’ Ø£Ø¶Ù proper waitFor()
          - Element not visible â†’ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´Ø±Ø·
          - API failed â†’ Ø±Ø§Ø¬Ø¹ network calls
          
          **Ù…Ù…Ù†ÙˆØ¹:**
          âŒ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
          âŒ Ø¥Ø¶Ø§ÙØ© setTimeout Ø¹Ø´ÙˆØ§Ø¦ÙŠ
          âŒ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
          âŒ Ø¹Ù…Ù„ commit Ø£Ùˆ push
          
          **Ù…Ø³Ù…ÙˆØ­:**
          âœ… ØªØ¹Ø¯ÙŠÙ„ src/**/*
          âœ… ØªØ¹Ø¯ÙŠÙ„ tests/**/*
          âœ… ØªØ¹Ø¯ÙŠÙ„ e2e/**/*
          âœ… Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚Ø§Øª ØªÙˆØ¶ÙŠØ­ÙŠØ©
          
          **Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:**
          - ÙƒÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªÙ†Ø¬Ø­
          - Ø§Ù„ÙƒÙˆØ¯ Ù†Ø¸ÙŠÙ ÙˆÙ…ÙÙ‡ÙˆÙ…
          - Ø¨Ø¯ÙˆÙ† side effects
          " --model ${{ github.event.inputs.model }}

      - name: ðŸ§ª Verify Fixes
        id: verify
        run: |
          echo "ðŸ§ª ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª..."
          npm test

      - name: âœ… Create Fix PR
        if: steps.verify.outcome == 'success'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          BRANCH_NAME="fix/manual-${{ github.run_id }}"
          
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git checkout -b $BRANCH_NAME
          git add -A
          git commit -m "ðŸ¤– fix: manual auto-fix (run ${{ github.run_id }})"
          git push origin $BRANCH_NAME
          
          gh pr create \
            --title "ðŸ¤– Ø¥ØµÙ„Ø§Ø­ ÙŠØ¯ÙˆÙŠ: Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Playwright" \
            --body "## ðŸ”§ Ø¥ØµÙ„Ø§Ø­Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
          
          ØªÙ… ØªØ´ØºÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù€ workflow **ÙŠØ¯ÙˆÙŠØ§Ù‹** Ø¨ÙˆØ§Ø³Ø·Ø© @${{ github.actor }}
          
          **Ø§Ù„ØªÙØ§ØµÙŠÙ„:**
          - ðŸ¤– Model: ${{ github.event.inputs.model }}
          - ðŸ†” Run ID: ${{ github.run_id }}
          - âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†
          
          **Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©:**
          - [ ] ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ù†Ø·Ù‚ÙŠØ©
          - [ ] Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨Ø©
          - [ ] Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªÙ…Ø± Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø±
          
          ---
          ðŸ”— [Workflow Run](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
          " \
            --base ${{ github.ref_name }} \
            --head $BRANCH_NAME

      - name: ðŸ“Š Fix Summary
        if: always()
        run: |
          echo "## ðŸ”§ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­" >> $GITHUB_STEP_SUMMARY
          if [ "${{ steps.verify.outcome }}" == "success" ]; then
            echo "âœ… **ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø¨Ù†Ø¬Ø§Ø­!** ðŸŽ‰" >> $GITHUB_STEP_SUMMARY
            echo "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ PR Ù…Ø¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ **ÙØ´Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­** ðŸ˜”" >> $GITHUB_STEP_SUMMARY
            echo "Ù‚Ø¯ ØªØ­ØªØ§Ø¬ ØªØ¯Ø®Ù„ ÙŠØ¯ÙˆÙŠ" >> $GITHUB_STEP_SUMMARY
          fi

  # ==========================================
  # Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø§Ù„ØªØ­Ø³ÙŠÙ†
  # ==========================================
  enhance:
    name: âœ¨ Enhance Code
    needs: [test, fix]
    # ÙŠØ´ØªØºÙ„ Ù„Ùˆ:
    # 1. Mode = test-fix-enhance ÙˆÙƒÙ„ Ø´ÙŠØ¡ Ù†Ø¬Ø­
    # 2. Ø£Ùˆ Mode = enhance-only
    if: |
      always() &&
      (github.event.inputs.mode == 'enhance-only' ||
       (github.event.inputs.mode == 'test-fix-enhance' && 
        (needs.test.outputs.test_passed == 'true' || needs.fix.outputs.fix_success == 'true')))
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ðŸ“¦ Install Dependencies
        run: npm ci

      - name: ðŸŽ­ Install Playwright
        run: npx playwright install --with-deps

      - name: ðŸš€ Install Cursor CLI
        run: |
          echo "ðŸš€ ØªØ«Ø¨ÙŠØª Cursor CLI..."
          curl https://cursor.com/install -fsS | bash
          echo "$HOME/.cursor/bin" >> $GITHUB_PATH

      - name: âœ¨ Run Enhancement Agent
        env:
          CURSOR_API_KEY: ${{ secrets.CURSOR_API_KEY }}
        run: |
          echo "âœ¨ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª..."
          
          cursor-agent -p "
          âœ¨ **ØªØ­Ø³ÙŠÙ† Ø¬ÙˆØ¯Ø© ÙƒÙˆØ¯ Playwright**
          
          **Ø§Ù„Ù…Ù‡Ù…Ø©:**
          Ø­Ø³Ù‘Ù† Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¨Ù‡Ø¯ÙˆØ¡ Ø¨Ø¯ÙˆÙ† Ø¹Ø¬Ù„Ø©
          
          **Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:**
          
          1. **Test Coverage** ðŸ“Š
             - Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒÙˆØ¯ Ø¨Ø¯ÙˆÙ† Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
             - Ø£Ø¶Ù tests Ù„Ù„Ù€ edge cases
             - Ø­Ø³Ù† Ø£ÙˆØµØ§Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
          
          2. **Performance** âš¡
             - Ù‚Ù„Ù„ ÙˆÙ‚Øª ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
             - Ø§Ø³ØªØ®Ø¯Ù… parallelization
             - Ù‚Ù„Ù„ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠ
          
          3. **Code Quality** â™»ï¸
             - Ø§Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙƒØ±Ø±
             - Ø­Ø³Ù† Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
             - Ø£Ø¶Ù comments Ù…ÙÙŠØ¯Ø©
             - Ø§Ø³ØªØ®Ø¯Ù… const Ø¨Ø¯Ù„ magic numbers
          
          4. **Best Practices** ðŸŽ¯
             - Ø§Ø³ØªØ®Ø¯Ù… Page Object Model
             - Ø­Ø³Ù† Ø§Ù„Ù€ selectors
             - Ø£Ø¶Ù proper fixtures
             - Ø­Ø³Ù† test isolation
          
          5. **Documentation** ðŸ“
             - Ø£Ø¶Ù JSDoc comments
             - Ø­Ø¯Ø« README
             - Ø£Ø¶Ù Ø£Ù…Ø«Ù„Ø©
          
          **Ù‚ÙˆØ§Ø¹Ø¯:**
          âœ… ØªØ­Ø³ÙŠÙ†Ø§Øª ØªØ¯Ø±ÙŠØ¬ÙŠØ©
          âœ… Ù„Ø§ ØªÙƒØ³Ø± Ø´ÙŠØ¡ Ø´ØºØ§Ù„
          âœ… Ø§Ø®ØªØ¨Ø± ÙƒÙ„ ØªØºÙŠÙŠØ±
          âœ… ÙˆØ«Ù‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©
          " --model ${{ github.event.inputs.model }}

      - name: ðŸ§ª Run Tests After Enhancement
        continue-on-error: true
        run: npm test

      - name: âœ… Create Enhancement PR
        if: success()
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          BRANCH_NAME="enhance/manual-${{ github.run_id }}"
          
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git checkout -b $BRANCH_NAME
          git add -A
          git commit -m "âœ¨ enhance: code quality improvements (manual run #${{ github.run_id }})" || echo "No changes to commit"
          git push origin $BRANCH_NAME
          
          gh pr create \
            --title "âœ¨ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ÙƒÙˆØ¯ (Manual Run #${{ github.run_id }})" \
            --body "## âœ¨ ØªØ­Ø³ÙŠÙ†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
          
          ØªÙ… ØªØ´ØºÙŠÙ„Ù‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¨ÙˆØ§Ø³Ø·Ø© @${{ github.actor }}
          
          **Ø§Ù„ØªÙØ§ØµÙŠÙ„:**
          - ðŸ¤– Model: ${{ github.event.inputs.model }}
          - ðŸ†” Run ID: ${{ github.run_id }}
          
          **Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª:**
          - ðŸ“Š Test coverage
          - âš¡ Performance
          - â™»ï¸ Code refactoring
          - ðŸ“ Documentation
          
          **Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©:**
          - [ ] ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ù†Ø·Ù‚ÙŠØ©
          - [ ] Ù„Ø§ ØªÙˆØ¬Ø¯ breaking changes
          - [ ] Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªÙ…Ø±
          
          ---
          ðŸ”— [Workflow Run](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
          " \
            --base ${{ github.ref_name }} \
            --head $BRANCH_NAME

      - name: ðŸ“Š Enhance Summary
        if: always()
        run: |
          echo "## âœ¨ Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ†" >> $GITHUB_STEP_SUMMARY
          if [ "${{ steps.test.outcome }}" == "success" ]; then
            echo "âœ… **ØªÙ… Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­ Ù…Ø¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª!** ðŸŽ‰" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ **ØªÙ… Ø§Ù„ØªØ­Ø³ÙŠÙ† Ù„ÙƒÙ† Ø¨Ø¹Ø¶ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©** âš ï¸" >> $GITHUB_STEP_SUMMARY
          fi

  # ==========================================
  # Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
  # ==========================================
  report:
    name: ðŸ“Š Final Report
    needs: [test, fix, enhance]
    if: always()
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“Š Generate Report
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          # ðŸŽ¯ ØªÙ‚Ø±ÙŠØ± Workflow Ø§Ù„ÙŠØ¯ÙˆÙŠ
          
          ## âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
          - **Mode:** ${{ github.event.inputs.mode }}
          - **Stop on Success:** ${{ github.event.inputs.stop_on_success }}
          - **Model:** ${{ github.event.inputs.model }}
          - **Ø´ØºÙ„Ù‡:** @${{ github.actor }}
          
          ## ðŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬
          | Ø§Ù„Ù…Ø±Ø­Ù„Ø© | Ø§Ù„Ø­Ø§Ù„Ø© |
          |---------|--------|
          | ðŸ§ª Tests | ${{ needs.test.result || 'ØªÙ… Ø§Ù„ØªØ®Ø·ÙŠ' }} |
          | ðŸ”§ Fix | ${{ needs.fix.result || 'ØªÙ… Ø§Ù„ØªØ®Ø·ÙŠ' }} |
          | âœ¨ Enhance | ${{ needs.enhance.result || 'ØªÙ… Ø§Ù„ØªØ®Ø·ÙŠ' }} |
          
          ## ðŸ”— Ø±ÙˆØ§Ø¨Ø· Ù…ÙÙŠØ¯Ø©
          - [Workflow Run](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
          - [Cursor Dashboard](https://cursor.com/dashboard?tab=background-agents)
          
          ---
          ðŸ¤– ØªÙ… Ø¨ÙˆØ§Ø³Ø·Ø© Cursor Agent
          EOF

      - name: ðŸ“¤ Upload Final Artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: final-report
          path: |
            test-results/
            playwright-report/
          retention-days: 30

