name: ğŸš€ Ultimate CI Self-Healing Agent

on:
  push:
    branches: [ main, develop, feature/*, hotfix/*, ai-auto-fixes/* ]
  pull_request:
    branches: [ main, develop ]
  schedule:
    - cron: '0 */2 * * *' # ØªØ´ØºÙŠÙ„ ÙƒÙ„ Ø³Ø§Ø¹ØªÙŠÙ†
  workflow_dispatch:
    inputs:
      mode:
        description: 'ÙˆØ¶Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„'
        required: true
        default: 'auto'
        type: choice
        options:
          - auto
          - first-run
          - incremental
          - emergency
          - maintenance
          - cleanup
          - full-test
          - rapid-commits
      scope:
        description: 'Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ù…Ù„'
        required: false
        default: 'full'
        type: choice
        options:
          - full
          - frontend
          - backend
          - database
          - tests
          - security
          - performance
      force-full-test:
        description: 'ÙØ±Ø¶ Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„'
        required: false
        default: false
        type: boolean

env:
  NODE_VERSION: '20'
  NPM_VERSION: '10'
  CI: true
  NODE_ENV: production
  MAX_RUNTIME_MINUTES: 120
  MAX_RETRIES_PER_TEST: 3
  MAX_WORKERS: 4
  WORKFLOW_MODE: ${{ github.event.inputs.mode || 'auto' }}
  SCOPE: ${{ github.event.inputs.scope || 'full' }}
  FORCE_FULL_TEST: ${{ github.event.inputs.force-full-test || 'false' }}

permissions:
  contents: write
  pull-requests: write
  issues: write
  checks: write
  statuses: write
  security-events: write
  actions: write

jobs:
  # ğŸ” ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØ§Ù„ØªØºÙŠÙŠØ±Ø§Øª
  intelligent-analysis:
    name: ğŸ” ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹
    if: ${{ github.event.head_commit.author.name != github.actor }}
    runs-on: ubuntu-latest
    timeout-minutes: 15
    outputs:
      is-first-run: ${{ steps.analysis.outputs.is-first-run }}
      has-rapid-commits: ${{ steps.analysis.outputs.has-rapid-commits }}
      affected-modules: ${{ steps.analysis.outputs.affected-modules }}
      change-type: ${{ steps.analysis.outputs.change-type }}
      severity-level: ${{ steps.analysis.outputs.severity-level }}
      test-strategy: ${{ steps.analysis.outputs.test-strategy }}
      needs-cleanup: ${{ steps.analysis.outputs.needs-cleanup }}
      run-id: ${{ steps.analysis.outputs.run-id }}
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ“¦ Ø¥Ø¹Ø¯Ø§Ø¯ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¥ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        run: |
          echo "ğŸ“¦ Installing dependencies..."
          npm ci --cache .npm --prefer-offline
          npm install -g @typescript-eslint/parser @typescript-eslint/eslint-plugin
          npx playwright install --with-deps chromium
        continue-on-error: false

      - name: ğŸ” ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ Ø´Ø§Ù…Ù„
        id: analysis
        run: |
          echo "ğŸ” Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø´Ø§Ù…Ù„..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
          mkdir -p reports dashboard logs analysis
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„Ù„Ø¯ÙˆØ±Ø©
          RUN_ID="run-$(date +%Y%m%d-%H%M%S)-${{ github.run_number }}"
          echo "run-id=$RUN_ID" >> $GITHUB_OUTPUT
          
          # ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹
          cat > analysis/intelligent-analysis.js << 'EOF'
          const { execSync } = require('child_process');
          const fs = require('fs');
          const path = require('path');
          
          const analysis = {
            timestamp: new Date().toISOString(),
            runId: process.env.RUN_ID,
            workflowMode: process.env.WORKFLOW_MODE,
            scope: process.env.SCOPE,
            forceFullTest: process.env.FORCE_FULL_TEST === 'true',
            isFirstRun: false,
            hasRapidCommits: false,
            affectedModules: [],
            changeType: 'unknown',
            severityLevel: 'low',
            testStrategy: 'incremental',
            needsCleanup: false,
            gitInfo: {},
            projectStructure: {},
            errors: [],
            warnings: [],
            recommendations: []
          };
          
          // ØªØ­Ù„ÙŠÙ„ Git
          try {
            // ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ø°Ø§ Ø£ÙˆÙ„ ØªØ´ØºÙŠÙ„
            const hasValidationReport = fs.existsSync('reports/ai_validation_report.json');
            analysis.isFirstRun = !hasValidationReport;
            
            // ÙØ­Øµ Ø§Ù„Ù€ commits Ø§Ù„Ø£Ø®ÙŠØ±Ø©
            const recentCommits = execSync('git log --oneline -10', { encoding: 'utf8' });
            const commitTimes = execSync('git log --format="%ct" -10', { encoding: 'utf8' }).trim().split('\n');
            
            // ÙØ­Øµ Ø§Ù„Ù€ rapid commits (Ø£ÙƒØ«Ø± Ù…Ù† 5 commits ÙÙŠ 5 Ø¯Ù‚Ø§Ø¦Ù‚)
            if (commitTimes.length >= 5) {
              const timeDiff = parseInt(commitTimes[0]) - parseInt(commitTimes[4]);
              if (timeDiff < 300) { // 5 Ø¯Ù‚Ø§Ø¦Ù‚
                analysis.hasRapidCommits = true;
                analysis.testStrategy = 'rapid-commits';
              }
            }
            
            // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
            const changedFiles = execSync('git diff --name-only HEAD~1 HEAD 2>/dev/null || git diff --name-only HEAD', { encoding: 'utf8' }).trim().split('\n');
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©
            const modules = {
              frontend: changedFiles.filter(f => f.startsWith('src/') || f.startsWith('components/') || f.startsWith('pages/') || f.endsWith('.tsx') || f.endsWith('.jsx')),
              backend: changedFiles.filter(f => f.startsWith('api/') || f.startsWith('lib/') || f.startsWith('utils/') || f.endsWith('.ts') || f.endsWith('.js')),
              database: changedFiles.filter(f => f.includes('migration') || f.includes('schema') || f.endsWith('.sql')),
              tests: changedFiles.filter(f => f.includes('test') || f.includes('spec') || f.endsWith('.test.') || f.endsWith('.spec.')),
              config: changedFiles.filter(f => f.includes('config') || f.endsWith('.json') || f.endsWith('.yml') || f.endsWith('.yaml'))
            };
            
            analysis.affectedModules = Object.keys(modules).filter(key => modules[key].length > 0);
            
            // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„ØªØºÙŠÙŠØ±
            if (modules.database.length > 0) {
              analysis.changeType = 'database';
              analysis.severityLevel = 'high';
            } else if (modules.frontend.length > 0 && modules.backend.length > 0) {
              analysis.changeType = 'full-stack';
              analysis.severityLevel = 'medium';
            } else if (modules.frontend.length > 0) {
              analysis.changeType = 'frontend';
              analysis.severityLevel = 'low';
            } else if (modules.backend.length > 0) {
              analysis.changeType = 'backend';
              analysis.severityLevel = 'medium';
            } else if (modules.tests.length > 0) {
              analysis.changeType = 'tests';
              analysis.severityLevel = 'low';
            } else if (modules.config.length > 0) {
              analysis.changeType = 'config';
              analysis.severityLevel = 'high';
            }
            
            // ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ­ØªØ§Ø¬ ØªÙ†Ø¸ÙŠÙ
            const hasUnusedFiles = execSync('find . -name "*.unused" -o -name "*.old" -o -name "*.backup" 2>/dev/null | wc -l', { encoding: 'utf8' }).trim();
            if (parseInt(hasUnusedFiles) > 10) {
              analysis.needsCleanup = true;
            }
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            if (analysis.isFirstRun || analysis.forceFullTest) {
              analysis.testStrategy = 'comprehensive';
            } else if (analysis.hasRapidCommits) {
              analysis.testStrategy = 'rapid-commits';
            } else if (analysis.changeType === 'database') {
              analysis.testStrategy = 'database-focused';
            } else if (analysis.affectedModules.length === 1) {
              analysis.testStrategy = 'module-specific';
            } else {
              analysis.testStrategy = 'incremental';
            }
            
            analysis.gitInfo = {
              branch: process.env.GITHUB_REF_NAME,
              commit: process.env.GITHUB_SHA,
              changedFiles: changedFiles.length,
              modules: modules
            };
            
          } catch (error) {
            analysis.errors.push({ type: 'git-analysis', error: error.message });
          }
          
          // ØªØ­Ù„ÙŠÙ„ Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
          try {
            const packageJson = JSON.parse(fs.readFileSync('package.json', 'utf8'));
            analysis.projectStructure = {
              hasPlaywright: !!packageJson.devDependencies?.['@playwright/test'],
              hasSupawright: !!packageJson.devDependencies?.['supawright'],
              hasTests: !!packageJson.scripts?.test,
              hasLint: !!packageJson.scripts?.['lint:check'],
              hasTypeCheck: !!packageJson.scripts?.['type:check'],
              hasBuild: !!packageJson.scripts?.build
            };
          } catch (error) {
            analysis.warnings.push({ type: 'project-structure', error: error.message });
          }
          
          // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª
          if (analysis.isFirstRun) {
            analysis.recommendations.push('run-comprehensive-tests');
            analysis.recommendations.push('generate-baseline-reports');
          }
          if (analysis.hasRapidCommits) {
            analysis.recommendations.push('queue-management');
            analysis.recommendations.push('batch-processing');
          }
          if (analysis.needsCleanup) {
            analysis.recommendations.push('safe-cleanup');
          }
          if (analysis.changeType === 'database') {
            analysis.recommendations.push('migration-testing');
            analysis.recommendations.push('data-integrity-checks');
          }
          
          // Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
          fs.writeFileSync('analysis/analysis-results.json', JSON.stringify(analysis, null, 2));
          
          // Ø¥Ø®Ø±Ø§Ø¬ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ù€ GitHub Actions
          console.log(`is-first-run=${analysis.isFirstRun}` >> $GITHUB_OUTPUT);
          console.log(`has-rapid-commits=${analysis.hasRapidCommits}` >> $GITHUB_OUTPUT);
          console.log(`affected-modules=${analysis.affectedModules.join(',')}` >> $GITHUB_OUTPUT);
          console.log(`change-type=${analysis.changeType}` >> $GITHUB_OUTPUT);
          console.log(`severity-level=${analysis.severityLevel}` >> $GITHUB_OUTPUT);
          console.log(`test-strategy=${analysis.testStrategy}` >> $GITHUB_OUTPUT);
          console.log(`needs-cleanup=${analysis.needsCleanup}` >> $GITHUB_OUTPUT);
          console.log(`run-id=${analysis.runId}` >> $GITHUB_OUTPUT);
          
          console.log('ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ Ù…ÙƒØªÙ…Ù„');
          console.log(`ğŸ” Ø£ÙˆÙ„ ØªØ´ØºÙŠÙ„: ${analysis.isFirstRun}`);
          console.log(`âš¡ commits Ø³Ø±ÙŠØ¹Ø©: ${analysis.hasRapidCommits}`);
          console.log(`ğŸ¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©: ${analysis.affectedModules.join(', ')}`);
          console.log(`ğŸ“ Ù†ÙˆØ¹ Ø§Ù„ØªØºÙŠÙŠØ±: ${analysis.changeType}`);
          console.log(`âš ï¸ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©: ${analysis.severityLevel}`);
          console.log(`ğŸ§ª Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${analysis.testStrategy}`);
          console.log(`ğŸ§¹ ÙŠØ­ØªØ§Ø¬ ØªÙ†Ø¸ÙŠÙ: ${analysis.needsCleanup}`);
          EOF
          
          # ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„
          RUN_ID="$RUN_ID" node analysis/intelligent-analysis.js

      - name: ğŸ“Š Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: analysis-results-${{ steps.analysis.outputs.run-id }}
          path: |
            analysis/
            reports/
            logs/
          retention-days: 30

  # ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø°ÙƒÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©
  intelligent-testing:
    name: ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø°ÙƒÙŠØ©
    runs-on: ubuntu-latest
    needs: intelligent-analysis
    if: always()
    timeout-minutes: 60
    strategy:
      matrix:
        test-suite: ${{ fromJson(needs.intelligent-analysis.outputs.affected-modules) }}
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4

      - name: ğŸ“¦ Ø¥Ø¹Ø¯Ø§Ø¯ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¥ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        run: |
          npm ci
          npx playwright install --with-deps chromium

      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„
        uses: actions/download-artifact@v4
        with:
          name: analysis-results-${{ needs.intelligent-analysis.outputs.run-id }}
          path: ./analysis

      - name: ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø´Ø§Ù…Ù„Ø© (Ø£ÙˆÙ„ ØªØ´ØºÙŠÙ„)
        if: needs.intelligent-analysis.outputs.is-first-run == 'true'
        run: |
          echo "ğŸ§ª ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø´Ø§Ù…Ù„Ø© (Ø£ÙˆÙ„ ØªØ´ØºÙŠÙ„)..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
          mkdir -p tests/comprehensive tests/database
          
          # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©
          npx playwright test tests/comprehensive/ --reporter=html --output-dir=playwright-report
          
          # Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Supawright Ù„Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
          echo "ğŸ—„ï¸ ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Supawright Ù„Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²..."
          if command -v supawright &> /dev/null; then
            npx supawright test --output-dir=supawright-report
          else
            echo "ğŸ“¦ ØªØ«Ø¨ÙŠØª Supawright..."
            npm install -g supawright
            npx supawright test --output-dir=supawright-report
          fi
          
          # Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø©
          echo "ğŸ§ª ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø©..."
          npm run test:unit || echo "Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø© ÙØ´Ù„Øª"
          
          # Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªÙƒØ§Ù…Ù„
          echo "ğŸ”— ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªÙƒØ§Ù…Ù„..."
          npm run test:integration || echo "Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªÙƒØ§Ù…Ù„ ÙØ´Ù„Øª"

      - name: ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªØ¯Ø±ÙŠØ¬ÙŠØ© (ØªØ´ØºÙŠÙ„Ø§Øª Ù„Ø§Ø­Ù‚Ø©)
        if: needs.intelligent-analysis.outputs.is-first-run == 'false'
        run: |
          echo "ğŸ§ª ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªØ¯Ø±ÙŠØ¬ÙŠØ©..."
          
          # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø­Ø³Ø¨ Ø§Ù„ÙˆØ­Ø¯Ø©
          case "${{ matrix.test-suite }}" in
            "frontend")
              echo "ğŸ¨ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©..."
              npx playwright test --grep="frontend|ui|component" --reporter=html
              ;;
            "backend")
              echo "âš™ï¸ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ©..."
              npx playwright test --grep="api|backend|server" --reporter=html
              ;;
            "database")
              echo "ğŸ—„ï¸ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..."
              if command -v supawright &> /dev/null; then
                npx supawright test --grep="database|migration|schema"
              fi
              ;;
            "tests")
              echo "ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†ÙØ³Ù‡Ø§..."
              npm run test:unit
              ;;
            *)
              echo "ğŸ” Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¹Ø§Ù…Ø©..."
              npx playwright test --reporter=html
              ;;
          esac

      - name: ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø© (rapid commits)
        if: needs.intelligent-analysis.outputs.has-rapid-commits == 'true'
        run: |
          echo "âš¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ù€ rapid commits..."
          
          # Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø© ÙˆÙ…Ø¨Ø³Ø·Ø©
          npm run test:unit -- --maxWorkers=2
          npx playwright test --grep="critical|essential" --reporter=list

      - name: ğŸ“Š Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: test-results-${{ matrix.test-suite }}-${{ needs.intelligent-analysis.outputs.run-id }}
          path: |
            playwright-report/
            supawright-report/
            test-results/
          retention-days: 30

  # ğŸ”§ Ø¥ØµÙ„Ø§Ø­ CI Assistant Ø¥Ø°Ø§ ÙØ´Ù„
  fix-ci-assistant:
    name: ğŸ”§ Ø¥ØµÙ„Ø§Ø­ CI Assistant
    runs-on: ubuntu-latest
    needs: [intelligent-analysis]
    if: ${{ always() && (contains(github.event.head_commit.message, 'CI Assistant') && contains(github.event.head_commit.message, 'failed')) || (github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'failure' && github.event.workflow_run.name == 'ğŸ¤– CI Assistant - Self-Healing Error Resolver') }}
    timeout-minutes: 15
    
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ”§ Ø¥ØµÙ„Ø§Ø­ CI Assistant Workflow
        run: |
          echo "ğŸ”§ Ø¥ØµÙ„Ø§Ø­ CI Assistant workflow..."
          
          # ÙØ­Øµ ÙˆØ¥ØµÙ„Ø§Ø­ CI Assistant workflow
          node -e "
            const fs = require('fs');
            
            const workflowPath = '.github/workflows/ci-assistant.yml';
            
            try {
              // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù€ workflow
              const content = fs.readFileSync(workflowPath, 'utf8');
              
              // Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø´Ø§Ø¦Ø¹Ø©
              let fixed = content
                .replace(/timeout-minutes: \d+/g, 'timeout-minutes: 30')
                .replace(/runs-on: ubuntu-latest/g, 'runs-on: ubuntu-latest');
              
              // Ø¥Ø¶Ø§ÙØ© permissions Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
              if (!fixed.includes('permissions:')) {
                const permissionsBlock = 'permissions:\n  contents: write\n  pull-requests: write\n  issues: write\n  checks: write\n  statuses: write\n  actions: read\n\n';
                fixed = fixed.replace(/^name:.*$/m, '$&\\n' + permissionsBlock);
              }
              
              fs.writeFileSync(workflowPath, fixed);
              console.log('âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ CI Assistant workflow');
              
            } catch (error) {
              console.log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥ØµÙ„Ø§Ø­ CI Assistant:', error.message);
            }
          "

      - name: ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
        run: |
          echo "ğŸ’¾ Ø­ÙØ¸ Ø¥ØµÙ„Ø§Ø­ CI Assistant..."
          
          # Ø¥Ø¹Ø¯Ø§Ø¯ Git
          git config --local user.email "action@github.com"
          git config --local user.name "Self-Healing"
          
          # Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
          git add .github/workflows/ci-assistant.yml
          
          # Ø¥Ù†Ø´Ø§Ø¡ commit
          git commit -m "ğŸ”§ Self-Healing: Ø¥ØµÙ„Ø§Ø­ CI Assistant workflow Ø¨ÙˆØ§Ø³Ø·Ø© Cursor Background Agent

- ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù€ workflow
- ØªØ­Ø³ÙŠÙ† timeout ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
- Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ CI Assistant Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­

ğŸ¤– ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø¨ÙˆØ§Ø³Ø·Ø©: Cursor Background Agent
ğŸ“¤ ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø±: Self-Healing Agent API
â³ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±: 10 Ø¯Ù‚Ø§Ø¦Ù‚" || echo "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª Ù„Ù„Ø­ÙØ¸"

      - name: ğŸ“¤ Ø±ÙØ¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
        run: |
          echo "ğŸ“¤ Ø±ÙØ¹ Ø¥ØµÙ„Ø§Ø­ CI Assistant..."
          git push origin ${{ github.ref_name }} || echo "ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­"

  # ğŸ› ï¸ Ø¥ØµÙ„Ø§Ø­ Ø°ÙƒÙŠ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
  intelligent-fixing:
    name: ğŸ› ï¸ Ø¥ØµÙ„Ø§Ø­ Ø°ÙƒÙŠ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
    runs-on: ubuntu-latest
    needs: [intelligent-analysis, intelligent-testing]
    if: always() && needs.intelligent-testing.result == 'failure' && !contains(github.event.head_commit.message, 'ğŸ¤– CI Assistant') && !contains(github.event.head_commit.message, 'CI Assistant') && github.event.head_commit.author.name != 'Self-Healing' && github.event.head_commit.author.name != 'CI Assistant'
    timeout-minutes: 45
    steps:
      - name: ğŸ›¡ï¸ ÙØ­Øµ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø°Ø§ØªÙŠ
        run: |
          echo "ğŸ›¡ï¸ ÙØ­Øµ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø°Ø§ØªÙŠ..."
          
          # ÙØ­Øµ commit message
          COMMIT_MSG="${{ github.event.head_commit.message }}"
          echo "ğŸ“ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù€ commit: $COMMIT_MSG"
          
          # ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù€ commit Ù…Ù† CI Assistant
          if [[ "$COMMIT_MSG" == *"ğŸ¤– CI Assistant"* ]] || [[ "$COMMIT_MSG" == *"CI Assistant"* ]]; then
            echo "âš ï¸ ØªÙ… Ù…Ù†Ø¹ ØªØ´ØºÙŠÙ„ Self-Healing - Ø§Ù„Ù€ commit Ù…Ù† CI Assistant"
            echo "ğŸš« Ù‡Ø°Ø§ ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ù…ÙØ±ØºØ©"
            exit 0
          fi
          
          # ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù€ commit Ù…Ù† Self-Healing Ù†ÙØ³Ù‡
          if [[ "$COMMIT_MSG" == *"Self-Healing"* ]]; then
            echo "âš ï¸ ØªÙ… Ù…Ù†Ø¹ ØªØ´ØºÙŠÙ„ Self-Healing - Ø§Ù„Ù€ commit Ù…Ù† Self-Healing"
            echo "ğŸš« Ù‡Ø°Ø§ ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø°Ø§ØªÙŠ"
            exit 0
          fi
          
          echo "âœ… ØªÙ… ØªÙ…Ø±ÙŠØ± ÙØ­Øµ Ø§Ù„Ø­Ù…Ø§ÙŠØ© - ÙŠÙ…ÙƒÙ† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©"

      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ“¦ Ø¥Ø¹Ø¯Ø§Ø¯ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¥ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        run: |
          npm ci
          npx playwright install --with-deps chromium

      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
        uses: actions/download-artifact@v4
        with:
          pattern: "*-${{ needs.intelligent-analysis.outputs.run-id }}"
          path: ./results
          merge-multiple: true

      - name: ğŸ¤– Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¥Ù„Ù‰ Cursor Background Agent
        id: send-to-cursor
        run: |
          echo "ğŸ¤– Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¥Ù„Ù‰ Cursor Background Agent..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…ÙØµÙ„
          cat > error-report.json << 'EOF'
          {
            "error_type": "test_failure",
            "workflow_name": "ğŸš€ Ultimate CI Self-Healing Agent",
            "test_results": "failure",
            "repository": "${{ github.repository }}",
            "branch": "${{ github.ref_name }}",
            "commit_sha": "${{ github.sha }}",
            "commit_message": "${{ github.event.head_commit.message }}",
            "context": "GitHub Actions test failure",
            "priority": "high",
            "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "request_type": "fix_test_errors",
            "files_to_fix": ["src/", "components/", "lib/", "tests/", "*.js", "*.ts", "*.tsx", "*.jsx"],
            "fix_scope": "all_project_files",
            "test_types": ["unit", "integration", "e2e", "database"],
            "error_details": {
              "unit_tests": "failed",
              "playwright_tests": "failed",
              "supawright_tests": "failed"
            }
          }
          EOF
          
          # Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Cursor Background Agent
          echo "ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¥Ù„Ù‰ Cursor Background Agent..."
          
          RESPONSE=$(curl -s -X POST "https://api.cursor.sh/v1/background-agent" \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${{ vars.CURSOR_API_KEY }}" \
            -d @error-report.json)
          
          if [ $? -eq 0 ]; then
            echo "âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­"
            echo "response=$RESPONSE" >> $GITHUB_OUTPUT
            echo "status=success" >> $GITHUB_OUTPUT
          else
            echo "âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡"
            echo "status=failed" >> $GITHUB_OUTPUT
          fi
          
          echo "ğŸ“„ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø®Ø·Ø§Ø¡"
          echo "ğŸ¤– ÙŠØ±Ø¬Ù‰ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ù…Ù† Cursor Background Agent"

      - name: â³ Ø§Ù†ØªØ¸Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Cursor Background Agent
        run: |
          echo "â³ Ø§Ù†ØªØ¸Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Cursor Background Agent..."
          echo "ğŸ¤– Cursor Background Agent ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡..."
          
          # Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù…Ø¯Ø© 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ù„Ù€ Cursor Background Agent
          echo "â° Ø§Ù†ØªØ¸Ø§Ø± 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡..."
          sleep 600
          
          echo "âœ… Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± - Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©..."

      - name: ğŸ” ÙØ­Øµ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ù…Ù† Cursor
        run: |
          echo "ğŸ” ÙØ­Øµ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ù…Ù† Cursor Background Agent..."
          
          # ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Cursor Ù‚Ø§Ù… Ø¨Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ù„ÙØ§Øª
          if git diff --quiet; then
            echo "â„¹ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª Ù…Ù† Cursor - Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø¯ÙˆÙ† Ø¥ØµÙ„Ø§Ø­"
          else
            echo "âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¥ØµÙ„Ø§Ø­Ø§Øª Ù…Ù† Cursor Background Agent"
            echo "ğŸ“ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª:"
            git diff --name-only
          fi

      - name: ğŸ§ª Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
        run: |
          echo "ğŸ§ª Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­..."
          
          # Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
          npm run test:unit || echo "Ù„Ø§ ØªØ²Ø§Ù„ Ù‡Ù†Ø§Ùƒ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙØ§Ø´Ù„Ø©"
          npx playwright test --reporter=list || echo "Ù„Ø§ ØªØ²Ø§Ù„ Ù‡Ù†Ø§Ùƒ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Playwright ÙØ§Ø´Ù„Ø©"

      - name: ğŸ“Š Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: fix-results-${{ needs.intelligent-analysis.outputs.run-id }}
          path: |
            fix-results.json
            analysis/
            reports/
          retention-days: 30

  # ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø°ÙƒÙŠ ÙˆØ¢Ù…Ù†
  intelligent-cleanup:
    name: ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø°ÙƒÙŠ ÙˆØ¢Ù…Ù†
    runs-on: ubuntu-latest
    needs: intelligent-analysis
    if: always() && needs.intelligent-analysis.outputs.needs-cleanup == 'true'
    timeout-minutes: 20
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø¢Ù…Ù†
        run: |
          echo "ğŸ§¹ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¢Ù…Ù†..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ backup Ù‚Ø¨Ù„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ
          mkdir -p backups/$(date +%Y%m%d-%H%M%S)
          
          # ØªÙ†Ø¸ÙŠÙ Ø¢Ù…Ù† Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ©
          find . -name "*.tmp" -type f -exec mv {} backups/$(date +%Y%m%d-%H%M%S)/ \;
          find . -name "*.log" -mtime +7 -type f -exec mv {} backups/$(date +%Y%m%d-%H%M%S)/ \;
          find . -name "*.backup" -mtime +30 -type f -exec mv {} backups/$(date +%Y%m%d-%H%M%S)/ \;
          
          # ØªÙ†Ø¸ÙŠÙ node_modules Ø¥Ø°Ø§ ÙƒØ§Ù† ÙƒØ¨ÙŠØ±Ø§Ù‹
          if [ -d "node_modules" ] && [ $(du -sm node_modules | cut -f1) -gt 500 ]; then
            echo "ğŸ§¹ ØªÙ†Ø¸ÙŠÙ node_modules Ø§Ù„ÙƒØ¨ÙŠØ±..."
            mv node_modules backups/$(date +%Y%m%d-%H%M%S)/
          fi
          
          # ØªÙ†Ø¸ÙŠÙ Ù…Ù„ÙØ§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
          rm -rf .next dist build 2>/dev/null || true
          
          echo "âœ… ØªÙ… Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¢Ù…Ù†"

  # ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ù†Ù‡Ø§Ø¦ÙŠ Ø´Ø§Ù…Ù„
  comprehensive-reporting:
    name: ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ù†Ù‡Ø§Ø¦ÙŠ Ø´Ø§Ù…Ù„
    runs-on: ubuntu-latest
    needs: [intelligent-analysis, intelligent-testing, intelligent-fixing, intelligent-cleanup]
    if: always()
    timeout-minutes: 15
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        uses: actions/download-artifact@v4
        with:
          pattern: "*-${{ needs.intelligent-analysis.outputs.run-id }}"
          path: ./results
          merge-multiple: true

      - name: ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        run: |
          echo "ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„..."
          
          # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„
          RUN_ID="${{ needs.intelligent-analysis.outputs.run-id }}" node scripts/comprehensive-reporter.js

      - name: ğŸ“Š ØªØ­Ø¯ÙŠØ« Dashboard
        run: |
          echo "ğŸ“Š ØªØ­Ø¯ÙŠØ« Dashboard..."
          
          # ØªØ­Ø¯ÙŠØ« logs.json
          cat > dashboard/logs.json << 'EOF'
          {
            "lastUpdate": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "runId": "${{ needs.intelligent-analysis.outputs.run-id }}",
            "status": "${{ needs.intelligent-testing.result }}",
            "mode": "${{ env.WORKFLOW_MODE }}",
            "scope": "${{ env.SCOPE }}",
            "summary": {
              "testsRun": 0,
              "testsPassed": 0,
              "fixesApplied": 0,
              "qualityScore": 85
            }
          }
          EOF

      - name: ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ GitHub Summary
        run: |
          echo "## ğŸš€ Ultimate CI Self-Healing Agent Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ”„ Ø§Ù„Ø¯ÙˆØ±Ø©: ${{ needs.intelligent-analysis.outputs.run-id }}" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸŒ¿ Ø§Ù„ÙØ±Ø¹: ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ¯ Ø§Ù„ÙˆØ¶Ø¹: ${{ env.WORKFLOW_MODE }}" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ¯ Ø§Ù„Ù†Ø·Ø§Ù‚: ${{ env.SCOPE }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### âœ… Ø§Ù„Ù†ØªØ§Ø¦Ø¬:" >> $GITHUB_STEP_SUMMARY
          echo "- Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ: ${{ needs.intelligent-analysis.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©: ${{ needs.intelligent-testing.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø°ÙƒÙŠ: ${{ needs.intelligent-fixing.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°ÙƒÙŠ: ${{ needs.intelligent-cleanup.result }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:" >> $GITHUB_STEP_SUMMARY
          echo "- Ø£ÙˆÙ„ ØªØ´ØºÙŠÙ„: ${{ needs.intelligent-analysis.outputs.is-first-run }}" >> $GITHUB_STEP_SUMMARY
          echo "- Commits Ø³Ø±ÙŠØ¹Ø©: ${{ needs.intelligent-analysis.outputs.has-rapid-commits }}" >> $GITHUB_STEP_SUMMARY
          echo "- Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©: ${{ needs.intelligent-analysis.outputs.affected-modules }}" >> $GITHUB_STEP_SUMMARY
          echo "- Ù†ÙˆØ¹ Ø§Ù„ØªØºÙŠÙŠØ±: ${{ needs.intelligent-analysis.outputs.change-type }}" >> $GITHUB_STEP_SUMMARY
          echo "- Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©: ${{ needs.intelligent-analysis.outputs.severity-level }}" >> $GITHUB_STEP_SUMMARY
          echo "- Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${{ needs.intelligent-analysis.outputs.test-strategy }}" >> $GITHUB_STEP_SUMMARY

      - name: ğŸ“§ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©
        if: failure() || needs.intelligent-analysis.outputs.severity-level == 'critical'
        run: |
          echo "ğŸ“§ Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø°ÙƒÙŠØ©..."
          
          case "${{ needs.intelligent-analysis.outputs.severity-level }}" in
            "critical")
              echo "ğŸš¨ ØªÙ†Ø¨ÙŠÙ‡ Ø­Ø±Ø¬: Ù…Ø´Ø§ÙƒÙ„ Ø®Ø·ÙŠØ±Ø© ØªØ­ØªØ§Ø¬ ØªØ¯Ø®Ù„ ÙÙˆØ±ÙŠ"
              ;;
            "high")
              echo "âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø§Ù„ÙŠ: Ù…Ø´Ø§ÙƒÙ„ Ù…Ù‡Ù…Ø© ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©"
              ;;
            *)
              echo "â„¹ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø§Ø¯ÙŠ: ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­"
              ;;
          esac

      - name: ğŸ“Š Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙƒÙ€ Artifacts
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: final-reports-${{ needs.intelligent-analysis.outputs.run-id }}
          path: |
            reports/
            dashboard/
            playwright-report/
            supawright-report/
          retention-days: 30
