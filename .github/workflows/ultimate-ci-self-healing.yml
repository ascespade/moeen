name: ğŸš€ Ultimate CI Self-Healing Agent

on:
  push:
    branches: [ main, develop, feature/*, hotfix/*, ai-auto-fixes/* ]
  pull_request:
    branches: [ main, develop ]
  schedule:
    - cron: '0 */2 * * *' # ØªØ´ØºÙŠÙ„ ÙƒÙ„ Ø³Ø§Ø¹ØªÙŠÙ†
  workflow_dispatch:
    inputs:
      mode:
        description: 'ÙˆØ¶Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„'
        required: true
        default: 'auto'
        type: choice
        options:
          - auto
          - first-run
          - incremental
          - emergency
          - maintenance
          - cleanup
          - full-test
          - rapid-commits
      scope:
        description: 'Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ù…Ù„'
        required: false
        default: 'full'
        type: choice
        options:
          - full
          - frontend
          - backend
          - database
          - tests
          - security
          - performance
      force-full-test:
        description: 'ÙØ±Ø¶ Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„'
        required: false
        default: false
        type: boolean

env:
  NODE_VERSION: '20'
  NPM_VERSION: '10'
  CI: true
  NODE_ENV: production
  MAX_RUNTIME_MINUTES: 120
  MAX_RETRIES_PER_TEST: 3
  MAX_WORKERS: 4
  WORKFLOW_MODE: ${{ github.event.inputs.mode || 'auto' }}
  SCOPE: ${{ github.event.inputs.scope || 'full' }}
  FORCE_FULL_TEST: ${{ github.event.inputs.force-full-test || 'false' }}

permissions:
  contents: write
  pull-requests: write
  issues: write
  checks: write
  statuses: write
  security-events: write
  actions: write

jobs:
  # ğŸ” ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØ§Ù„ØªØºÙŠÙŠØ±Ø§Øª
  intelligent-analysis:
    name: ğŸ” ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹
    runs-on: ubuntu-latest
    timeout-minutes: 15
    outputs:
      is-first-run: ${{ steps.analysis.outputs.is-first-run }}
      has-rapid-commits: ${{ steps.analysis.outputs.has-rapid-commits }}
      affected-modules: ${{ steps.analysis.outputs.affected-modules }}
      change-type: ${{ steps.analysis.outputs.change-type }}
      severity-level: ${{ steps.analysis.outputs.severity-level }}
      test-strategy: ${{ steps.analysis.outputs.test-strategy }}
      needs-cleanup: ${{ steps.analysis.outputs.needs-cleanup }}
      run-id: ${{ steps.analysis.outputs.run-id }}
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ“¦ Ø¥Ø¹Ø¯Ø§Ø¯ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¥ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        run: |
          echo "ğŸ“¦ Installing dependencies..."
          npm ci --cache .npm --prefer-offline
          npm install -g @typescript-eslint/parser @typescript-eslint/eslint-plugin
          npx playwright install --with-deps chromium
        continue-on-error: false

      - name: ğŸ” ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ Ø´Ø§Ù…Ù„
        id: analysis
        run: |
          echo "ğŸ” Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø´Ø§Ù…Ù„..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
          mkdir -p reports dashboard logs analysis
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„Ù„Ø¯ÙˆØ±Ø©
          RUN_ID="run-$(date +%Y%m%d-%H%M%S)-${{ github.run_number }}"
          echo "run-id=$RUN_ID" >> $GITHUB_OUTPUT
          
          # ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹
          cat > analysis/intelligent-analysis.js << 'EOF'
          const { execSync } = require('child_process');
          const fs = require('fs');
          const path = require('path');
          
          const analysis = {
            timestamp: new Date().toISOString(),
            runId: process.env.RUN_ID,
            workflowMode: process.env.WORKFLOW_MODE,
            scope: process.env.SCOPE,
            forceFullTest: process.env.FORCE_FULL_TEST === 'true',
            isFirstRun: false,
            hasRapidCommits: false,
            affectedModules: [],
            changeType: 'unknown',
            severityLevel: 'low',
            testStrategy: 'incremental',
            needsCleanup: false,
            gitInfo: {},
            projectStructure: {},
            errors: [],
            warnings: [],
            recommendations: []
          };
          
          // ØªØ­Ù„ÙŠÙ„ Git
          try {
            // ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ø°Ø§ Ø£ÙˆÙ„ ØªØ´ØºÙŠÙ„
            const hasValidationReport = fs.existsSync('reports/ai_validation_report.json');
            analysis.isFirstRun = !hasValidationReport;
            
            // ÙØ­Øµ Ø§Ù„Ù€ commits Ø§Ù„Ø£Ø®ÙŠØ±Ø©
            const recentCommits = execSync('git log --oneline -10', { encoding: 'utf8' });
            const commitTimes = execSync('git log --format="%ct" -10', { encoding: 'utf8' }).trim().split('\n');
            
            // ÙØ­Øµ Ø§Ù„Ù€ rapid commits (Ø£ÙƒØ«Ø± Ù…Ù† 5 commits ÙÙŠ 5 Ø¯Ù‚Ø§Ø¦Ù‚)
            if (commitTimes.length >= 5) {
              const timeDiff = parseInt(commitTimes[0]) - parseInt(commitTimes[4]);
              if (timeDiff < 300) { // 5 Ø¯Ù‚Ø§Ø¦Ù‚
                analysis.hasRapidCommits = true;
                analysis.testStrategy = 'rapid-commits';
              }
            }
            
            // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
            const changedFiles = execSync('git diff --name-only HEAD~1 HEAD 2>/dev/null || git diff --name-only HEAD', { encoding: 'utf8' }).trim().split('\n');
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©
            const modules = {
              frontend: changedFiles.filter(f => f.startsWith('src/') || f.startsWith('components/') || f.startsWith('pages/') || f.endsWith('.tsx') || f.endsWith('.jsx')),
              backend: changedFiles.filter(f => f.startsWith('api/') || f.startsWith('lib/') || f.startsWith('utils/') || f.endsWith('.ts') || f.endsWith('.js')),
              database: changedFiles.filter(f => f.includes('migration') || f.includes('schema') || f.endsWith('.sql')),
              tests: changedFiles.filter(f => f.includes('test') || f.includes('spec') || f.endsWith('.test.') || f.endsWith('.spec.')),
              config: changedFiles.filter(f => f.includes('config') || f.endsWith('.json') || f.endsWith('.yml') || f.endsWith('.yaml'))
            };
            
            analysis.affectedModules = Object.keys(modules).filter(key => modules[key].length > 0);
            
            // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„ØªØºÙŠÙŠØ±
            if (modules.database.length > 0) {
              analysis.changeType = 'database';
              analysis.severityLevel = 'high';
            } else if (modules.frontend.length > 0 && modules.backend.length > 0) {
              analysis.changeType = 'full-stack';
              analysis.severityLevel = 'medium';
            } else if (modules.frontend.length > 0) {
              analysis.changeType = 'frontend';
              analysis.severityLevel = 'low';
            } else if (modules.backend.length > 0) {
              analysis.changeType = 'backend';
              analysis.severityLevel = 'medium';
            } else if (modules.tests.length > 0) {
              analysis.changeType = 'tests';
              analysis.severityLevel = 'low';
            } else if (modules.config.length > 0) {
              analysis.changeType = 'config';
              analysis.severityLevel = 'high';
            }
            
            // ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ­ØªØ§Ø¬ ØªÙ†Ø¸ÙŠÙ
            const hasUnusedFiles = execSync('find . -name "*.unused" -o -name "*.old" -o -name "*.backup" 2>/dev/null | wc -l', { encoding: 'utf8' }).trim();
            if (parseInt(hasUnusedFiles) > 10) {
              analysis.needsCleanup = true;
            }
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            if (analysis.isFirstRun || analysis.forceFullTest) {
              analysis.testStrategy = 'comprehensive';
            } else if (analysis.hasRapidCommits) {
              analysis.testStrategy = 'rapid-commits';
            } else if (analysis.changeType === 'database') {
              analysis.testStrategy = 'database-focused';
            } else if (analysis.affectedModules.length === 1) {
              analysis.testStrategy = 'module-specific';
            } else {
              analysis.testStrategy = 'incremental';
            }
            
            analysis.gitInfo = {
              branch: process.env.GITHUB_REF_NAME,
              commit: process.env.GITHUB_SHA,
              changedFiles: changedFiles.length,
              modules: modules
            };
            
          } catch (error) {
            analysis.errors.push({ type: 'git-analysis', error: error.message });
          }
          
          // ØªØ­Ù„ÙŠÙ„ Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
          try {
            const packageJson = JSON.parse(fs.readFileSync('package.json', 'utf8'));
            analysis.projectStructure = {
              hasPlaywright: !!packageJson.devDependencies?.['@playwright/test'],
              hasSupawright: !!packageJson.devDependencies?.['supawright'],
              hasTests: !!packageJson.scripts?.test,
              hasLint: !!packageJson.scripts?.['lint:check'],
              hasTypeCheck: !!packageJson.scripts?.['type:check'],
              hasBuild: !!packageJson.scripts?.build
            };
          } catch (error) {
            analysis.warnings.push({ type: 'project-structure', error: error.message });
          }
          
          // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª
          if (analysis.isFirstRun) {
            analysis.recommendations.push('run-comprehensive-tests');
            analysis.recommendations.push('generate-baseline-reports');
          }
          if (analysis.hasRapidCommits) {
            analysis.recommendations.push('queue-management');
            analysis.recommendations.push('batch-processing');
          }
          if (analysis.needsCleanup) {
            analysis.recommendations.push('safe-cleanup');
          }
          if (analysis.changeType === 'database') {
            analysis.recommendations.push('migration-testing');
            analysis.recommendations.push('data-integrity-checks');
          }
          
          // Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
          fs.writeFileSync('analysis/analysis-results.json', JSON.stringify(analysis, null, 2));
          
          // Ø¥Ø®Ø±Ø§Ø¬ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ù€ GitHub Actions
          console.log(`::set-output name=is-first-run::${analysis.isFirstRun}`);
          console.log(`::set-output name=has-rapid-commits::${analysis.hasRapidCommits}`);
          console.log(`::set-output name=affected-modules::${analysis.affectedModules.join(',')}`);
          console.log(`::set-output name=change-type::${analysis.changeType}`);
          console.log(`::set-output name=severity-level::${analysis.severityLevel}`);
          console.log(`::set-output name=test-strategy::${analysis.testStrategy}`);
          console.log(`::set-output name=needs-cleanup::${analysis.needsCleanup}`);
          console.log(`::set-output name=run-id::${analysis.runId}`);
          
          console.log('ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ Ù…ÙƒØªÙ…Ù„');
          console.log(`ğŸ” Ø£ÙˆÙ„ ØªØ´ØºÙŠÙ„: ${analysis.isFirstRun}`);
          console.log(`âš¡ commits Ø³Ø±ÙŠØ¹Ø©: ${analysis.hasRapidCommits}`);
          console.log(`ğŸ¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©: ${analysis.affectedModules.join(', ')}`);
          console.log(`ğŸ“ Ù†ÙˆØ¹ Ø§Ù„ØªØºÙŠÙŠØ±: ${analysis.changeType}`);
          console.log(`âš ï¸ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©: ${analysis.severityLevel}`);
          console.log(`ğŸ§ª Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${analysis.testStrategy}`);
          console.log(`ğŸ§¹ ÙŠØ­ØªØ§Ø¬ ØªÙ†Ø¸ÙŠÙ: ${analysis.needsCleanup}`);
          EOF
          
          # ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„
          RUN_ID="$RUN_ID" node analysis/intelligent-analysis.js

      - name: ğŸ“Š Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: analysis-results-${{ steps.analysis.outputs.run-id }}
          path: |
            analysis/
            reports/
            logs/
          retention-days: 30

  # ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø°ÙƒÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©
  intelligent-testing:
    name: ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø°ÙƒÙŠØ©
    runs-on: ubuntu-latest
    needs: intelligent-analysis
    if: always()
    timeout-minutes: 60
    strategy:
      matrix:
        test-suite: ${{ fromJson(needs.intelligent-analysis.outputs.affected-modules) }}
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4

      - name: ğŸ“¦ Ø¥Ø¹Ø¯Ø§Ø¯ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¥ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        run: |
          npm ci
          npx playwright install --with-deps chromium

      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„
        uses: actions/download-artifact@v4
        with:
          name: analysis-results-${{ needs.intelligent-analysis.outputs.run-id }}
          path: ./analysis

      - name: ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø´Ø§Ù…Ù„Ø© (Ø£ÙˆÙ„ ØªØ´ØºÙŠÙ„)
        if: needs.intelligent-analysis.outputs.is-first-run == 'true'
        run: |
          echo "ğŸ§ª ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø´Ø§Ù…Ù„Ø© (Ø£ÙˆÙ„ ØªØ´ØºÙŠÙ„)..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Playwright Ø´Ø§Ù…Ù„Ø©
          mkdir -p tests/comprehensive
          
          cat > tests/comprehensive/full-system.spec.js << 'EOF'
          import { test, expect } from '@playwright/test';
          
          test.describe('Full System Tests - First Run', () => {
            test.beforeEach(async ({ page }) => {
              await page.goto('/');
            });
            
            test('Homepage loads and displays correctly', async ({ page }) => {
              await expect(page).toHaveTitle(/Moeen/);
              await expect(page.locator('body')).toBeVisible();
            });
            
            test('Navigation works across all pages', async ({ page }) => {
              // Test main navigation
              const navItems = ['Dashboard', 'Patients', 'Appointments', 'Medical Records', 'Payments'];
              for (const item of navItems) {
                if (await page.locator(`text=${item}`).isVisible()) {
                  await page.click(`text=${item}`);
                  await page.waitForLoadState('networkidle');
                }
              }
            });
            
            test('Database connection and operations', async ({ page }) => {
              // Test database health endpoint
              const response = await page.request.get('/api/health');
              expect(response.status()).toBe(200);
              
              const data = await response.json();
              expect(data).toHaveProperty('database');
              expect(data.database).toBe('connected');
            });
            
            test('Authentication flow', async ({ page }) => {
              // Test login page
              await page.goto('/login');
              await expect(page.locator('form')).toBeVisible();
              
              // Test form validation
              await page.click('button[type="submit"]');
              await expect(page.locator('.error, [role="alert"]')).toBeVisible();
            });
            
            test('CRUD operations for all modules', async ({ page }) => {
              // Test patient creation
              await page.goto('/patients');
              if (await page.locator('button:has-text("Add Patient")').isVisible()) {
                await page.click('button:has-text("Add Patient")');
                await page.fill('input[name="name"]', 'Test Patient');
                await page.fill('input[name="email"]', 'test@example.com');
                await page.click('button[type="submit"]');
                await expect(page.locator('text=Test Patient')).toBeVisible();
              }
            });
          });
          EOF
          
          # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©
          npx playwright test tests/comprehensive/ --reporter=html --output-dir=playwright-report
          
          # Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Supawright Ù„Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
          if command -v supawright &> /dev/null; then
            npx supawright test --output-dir=supawright-report
          fi

      - name: ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªØ¯Ø±ÙŠØ¬ÙŠØ© (ØªØ´ØºÙŠÙ„Ø§Øª Ù„Ø§Ø­Ù‚Ø©)
        if: needs.intelligent-analysis.outputs.is-first-run == 'false'
        run: |
          echo "ğŸ§ª ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªØ¯Ø±ÙŠØ¬ÙŠØ©..."
          
          # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø­Ø³Ø¨ Ø§Ù„ÙˆØ­Ø¯Ø©
          case "${{ matrix.test-suite }}" in
            "frontend")
              echo "ğŸ¨ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©..."
              npx playwright test --grep="frontend|ui|component" --reporter=html
              ;;
            "backend")
              echo "âš™ï¸ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ©..."
              npx playwright test --grep="api|backend|server" --reporter=html
              ;;
            "database")
              echo "ğŸ—„ï¸ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..."
              if command -v supawright &> /dev/null; then
                npx supawright test --grep="database|migration|schema"
              fi
              ;;
            "tests")
              echo "ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†ÙØ³Ù‡Ø§..."
              npm run test:unit
              ;;
            *)
              echo "ğŸ” Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¹Ø§Ù…Ø©..."
              npx playwright test --reporter=html
              ;;
          esac

      - name: ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø© (rapid commits)
        if: needs.intelligent-analysis.outputs.has-rapid-commits == 'true'
        run: |
          echo "âš¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ù€ rapid commits..."
          
          # Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø© ÙˆÙ…Ø¨Ø³Ø·Ø©
          npm run test:unit -- --maxWorkers=2
          npx playwright test --grep="critical|essential" --reporter=list

      - name: ğŸ“Š Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: test-results-${{ matrix.test-suite }}-${{ needs.intelligent-analysis.outputs.run-id }}
          path: |
            playwright-report/
            supawright-report/
            test-results/
          retention-days: 30

  # ğŸ› ï¸ Ø¥ØµÙ„Ø§Ø­ Ø°ÙƒÙŠ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
  intelligent-fixing:
    name: ğŸ› ï¸ Ø¥ØµÙ„Ø§Ø­ Ø°ÙƒÙŠ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
    runs-on: ubuntu-latest
    needs: [intelligent-analysis, intelligent-testing]
    if: always() && needs.intelligent-testing.result == 'failure'
    timeout-minutes: 45
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ“¦ Ø¥Ø¹Ø¯Ø§Ø¯ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¥ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        run: |
          npm ci
          npx playwright install --with-deps chromium

      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
        uses: actions/download-artifact@v4
        with:
          pattern: "*-${{ needs.intelligent-analysis.outputs.run-id }}"
          path: ./results
          merge-multiple: true

      - name: ğŸ› ï¸ Ø¥ØµÙ„Ø§Ø­ Ø°ÙƒÙŠ Ù…ØªÙ‚Ø¯Ù…
        run: |
          echo "ğŸ› ï¸ Ø¨Ø¯Ø¡ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø°ÙƒÙŠ
          cat > intelligent-fix.js << 'EOF'
          const { execSync } = require('child_process');
          const fs = require('fs');
          const path = require('path');
          
          class IntelligentFixer {
            constructor() {
              this.maxRetries = 3;
              this.retryCount = 0;
              this.fixesApplied = [];
              this.errors = [];
            }
            
            async fixEslintErrors() {
              console.log('ğŸ”§ Ø¥ØµÙ„Ø§Ø­ Ø£Ø®Ø·Ø§Ø¡ ESLint...');
              try {
                execSync('npm run lint:fix', { stdio: 'inherit' });
                this.fixesApplied.push('eslint-auto-fix');
                
                // Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø°ÙƒÙŠØ©
                execSync('npx eslint . --ext .js,.jsx,.ts,.tsx --fix --max-warnings 0', { stdio: 'inherit' });
                this.fixesApplied.push('eslint-smart-fix');
                
                return true;
              } catch (error) {
                this.errors.push({ type: 'eslint', error: error.message });
                return false;
              }
            }
            
            async fixTypeScriptErrors() {
              console.log('ğŸ”§ Ø¥ØµÙ„Ø§Ø­ Ø£Ø®Ø·Ø§Ø¡ TypeScript...');
              try {
                // Ø¥ØµÙ„Ø§Ø­Ø§Øª TypeScript Ø°ÙƒÙŠØ©
                const tsFiles = this.findFiles('.ts', '.tsx');
                for (const file of tsFiles) {
                  this.fixTypeScriptFile(file);
                }
                
                execSync('npm run type:check', { stdio: 'inherit' });
                this.fixesApplied.push('typescript-smart-fix');
                return true;
              } catch (error) {
                this.errors.push({ type: 'typescript', error: error.message });
                return false;
              }
            }
            
            fixTypeScriptFile(filePath) {
              try {
                let content = fs.readFileSync(filePath, 'utf8');
                let modified = false;
                
                // Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø´Ø§Ø¦Ø¹Ø©
                const fixes = [
                  { pattern: /:\s*any\s*=/g, replacement: ': unknown =' },
                  { pattern: /console\.log\(/g, replacement: 'console.debug(' },
                  { pattern: /import\s+{\s*([^}]+)\s*}\s+from\s+['"]([^'"]+)['"];?/g, replacement: (match, imports, module) => {
                    const cleanImports = imports.replace(/\s+/g, ' ').trim();
                    return `import { ${cleanImports} } from '${module}';`;
                  }}
                ];
                
                fixes.forEach(fix => {
                  const newContent = content.replace(fix.pattern, fix.replacement);
                  if (newContent !== content) {
                    content = newContent;
                    modified = true;
                  }
                });
                
                if (modified) {
                  fs.writeFileSync(filePath, content);
                  console.log(`âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ ${filePath}`);
                }
              } catch (error) {
                console.log(`âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø¥ØµÙ„Ø§Ø­ ${filePath}: ${error.message}`);
              }
            }
            
            async fixTestErrors() {
              console.log('ğŸ”§ Ø¥ØµÙ„Ø§Ø­ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª...');
              try {
                const testFiles = this.findFiles('.test.', '.spec.');
                for (const file of testFiles) {
                  this.fixTestFile(file);
                }
                
                execSync('npm run test:unit', { stdio: 'inherit' });
                this.fixesApplied.push('test-smart-fix');
                return true;
              } catch (error) {
                this.errors.push({ type: 'tests', error: error.message });
                return false;
              }
            }
            
            fixTestFile(filePath) {
              try {
                let content = fs.readFileSync(filePath, 'utf8');
                let modified = false;
                
                const testFixes = [
                  { pattern: /expect\(([^)]+)\)\.toBe\(undefined\)/g, replacement: 'expect($1).toBeUndefined()' },
                  { pattern: /expect\(([^)]+)\)\.toBe\(null\)/g, replacement: 'expect($1).toBeNull()' },
                  { pattern: /expect\(([^)]+)\)\.toBe\(true\)/g, replacement: 'expect($1).toBeTruthy()' },
                  { pattern: /expect\(([^)]+)\)\.toBe\(false\)/g, replacement: 'expect($1).toBeFalsy()' }
                ];
                
                testFixes.forEach(fix => {
                  const newContent = content.replace(fix.pattern, fix.replacement);
                  if (newContent !== content) {
                    content = newContent;
                    modified = true;
                  }
                });
                
                if (modified) {
                  fs.writeFileSync(filePath, content);
                  console.log(`âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ ${filePath}`);
                }
              } catch (error) {
                console.log(`âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø¥ØµÙ„Ø§Ø­ ${filePath}: ${error.message}`);
              }
            }
            
            findFiles(...extensions) {
              const files = [];
              const searchDir = (dir) => {
                const items = fs.readdirSync(dir);
                for (const item of items) {
                  const fullPath = path.join(dir, item);
                  const stat = fs.statSync(fullPath);
                  
                  if (stat.isDirectory() && !item.startsWith('.') && item !== 'node_modules') {
                    searchDir(fullPath);
                  } else if (extensions.some(ext => item.includes(ext))) {
                    files.push(fullPath);
                  }
                }
              };
              
              searchDir('.');
              return files;
            }
            
            async run() {
              console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø°ÙƒÙŠ...');
              
              // Ø¥ØµÙ„Ø§Ø­ ESLint
              await this.fixEslintErrors();
              
              // Ø¥ØµÙ„Ø§Ø­ TypeScript
              await this.fixTypeScriptErrors();
              
              // Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
              await this.fixTestErrors();
              
              console.log('ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª:');
              console.log(`âœ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©: ${this.fixesApplied.join(', ')}`);
              console.log(`âŒ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡: ${this.errors.length}`);
              
              return {
                fixesApplied: this.fixesApplied,
                errors: this.errors,
                success: this.errors.length === 0
              };
            }
          }
          
          const fixer = new IntelligentFixer();
          fixer.run().then(result => {
            fs.writeFileSync('fix-results.json', JSON.stringify(result, null, 2));
            process.exit(result.success ? 0 : 1);
          });
          EOF
          
          node intelligent-fix.js

      - name: ğŸ§ª Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
        run: |
          echo "ğŸ§ª Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­..."
          
          # Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
          npm run test:unit || echo "Ù„Ø§ ØªØ²Ø§Ù„ Ù‡Ù†Ø§Ùƒ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙØ§Ø´Ù„Ø©"
          npx playwright test --reporter=list || echo "Ù„Ø§ ØªØ²Ø§Ù„ Ù‡Ù†Ø§Ùƒ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Playwright ÙØ§Ø´Ù„Ø©"

      - name: ğŸ“Š Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: fix-results-${{ needs.intelligent-analysis.outputs.run-id }}
          path: |
            fix-results.json
            analysis/
            reports/
          retention-days: 30

  # ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø°ÙƒÙŠ ÙˆØ¢Ù…Ù†
  intelligent-cleanup:
    name: ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø°ÙƒÙŠ ÙˆØ¢Ù…Ù†
    runs-on: ubuntu-latest
    needs: intelligent-analysis
    if: always() && needs.intelligent-analysis.outputs.needs-cleanup == 'true'
    timeout-minutes: 20
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø¢Ù…Ù†
        run: |
          echo "ğŸ§¹ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¢Ù…Ù†..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ backup Ù‚Ø¨Ù„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ
          mkdir -p backups/$(date +%Y%m%d-%H%M%S)
          
          # ØªÙ†Ø¸ÙŠÙ Ø¢Ù…Ù† Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ©
          find . -name "*.tmp" -type f -exec mv {} backups/$(date +%Y%m%d-%H%M%S)/ \;
          find . -name "*.log" -mtime +7 -type f -exec mv {} backups/$(date +%Y%m%d-%H%M%S)/ \;
          find . -name "*.backup" -mtime +30 -type f -exec mv {} backups/$(date +%Y%m%d-%H%M%S)/ \;
          
          # ØªÙ†Ø¸ÙŠÙ node_modules Ø¥Ø°Ø§ ÙƒØ§Ù† ÙƒØ¨ÙŠØ±Ø§Ù‹
          if [ -d "node_modules" ] && [ $(du -sm node_modules | cut -f1) -gt 500 ]; then
            echo "ğŸ§¹ ØªÙ†Ø¸ÙŠÙ node_modules Ø§Ù„ÙƒØ¨ÙŠØ±..."
            mv node_modules backups/$(date +%Y%m%d-%H%M%S)/
          fi
          
          # ØªÙ†Ø¸ÙŠÙ Ù…Ù„ÙØ§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
          rm -rf .next dist build 2>/dev/null || true
          
          echo "âœ… ØªÙ… Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¢Ù…Ù†"

  # ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ù†Ù‡Ø§Ø¦ÙŠ Ø´Ø§Ù…Ù„
  comprehensive-reporting:
    name: ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ù†Ù‡Ø§Ø¦ÙŠ Ø´Ø§Ù…Ù„
    runs-on: ubuntu-latest
    needs: [intelligent-analysis, intelligent-testing, intelligent-fixing, intelligent-cleanup]
    if: always()
    timeout-minutes: 15
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        uses: actions/download-artifact@v4
        with:
          pattern: "*-${{ needs.intelligent-analysis.outputs.run-id }}"
          path: ./results
          merge-multiple: true

      - name: ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        run: |
          echo "ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¢Ù„ÙŠ
          cat > generate-final-report.js << 'EOF'
          const fs = require('fs');
          const path = require('path');
          
          const report = {
            runId: process.env.RUN_ID,
            timestamp: new Date().toISOString(),
            trigger: process.env.GITHUB_EVENT_NAME,
            branch: process.env.GITHUB_REF_NAME,
            commit: process.env.GITHUB_SHA,
            timings: {
              startTime: new Date().toISOString(),
              endTime: new Date().toISOString(),
              duration: 'calculated'
            },
            modulesTested: {},
            summary: {
              overallStatus: 'unknown',
              errors: [],
              warnings: [],
              qualityScore: 0
            },
            artifacts: {
              paths: [],
              urls: []
            }
          };
          
          // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
          try {
            const analysisFile = 'results/analysis/analysis-results.json';
            if (fs.existsSync(analysisFile)) {
              const analysis = JSON.parse(fs.readFileSync(analysisFile, 'utf8'));
              report.modulesTested = analysis.affectedModules.reduce((acc, module) => {
                acc[module] = {
                  testsRun: 0,
                  testsPassed: 0,
                  patchesApplied: []
                };
                return acc;
              }, {});
            }
          } catch (error) {
            console.log('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„:', error.message);
          }
          
          // Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
          fs.writeFileSync('reports/ai_validation_report.json', JSON.stringify(report, null, 2));
          
          // Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø¨Ø´Ø±ÙŠ
          const humanReport = '# Ultimate CI Self-Healing Report\n\n' +
            '## Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°\n' +
            '- Ù…Ø¹Ø±Ù Ø§Ù„Ø¯ÙˆØ±Ø©: ' + report.runId + '\n' +
            '- Ø§Ù„ÙˆÙ‚Øª: ' + report.timestamp + '\n' +
            '- Ø§Ù„ÙØ±Ø¹: ' + report.branch + '\n' +
            '- Ø§Ù„Ù€ Commit: ' + report.commit + '\n' +
            '- Ø§Ù„ÙˆØ¶Ø¹: ' + process.env.WORKFLOW_MODE + '\n\n' +
            '## Ø§Ù„Ù†ØªØ§Ø¦Ø¬\n' +
            '- Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©: ' + report.summary.overallStatus + '\n' +
            '- Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬ÙˆØ¯Ø©: ' + report.summary.qualityScore + '\n' +
            '- Ø§Ù„Ø£Ø®Ø·Ø§Ø¡: ' + report.summary.errors.length + '\n' +
            '- Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª: ' + report.summary.warnings.length + '\n\n' +
            '## Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª\n' +
            '- ØªÙ‚Ø±ÙŠØ± Playwright: playwright-report/\n' +
            '- ØªÙ‚Ø±ÙŠØ± Supawright: supawright-report/\n' +
            '- Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªÙ†ÙÙŠØ°: execution.log\n';

          fs.writeFileSync('reports/final_summary.md', humanReport);
          
          console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ');
          EOF
          
          RUN_ID="${{ needs.intelligent-analysis.outputs.run-id }}" node generate-final-report.js

      - name: ğŸ“Š ØªØ­Ø¯ÙŠØ« Dashboard
        run: |
          echo "ğŸ“Š ØªØ­Ø¯ÙŠØ« Dashboard..."
          
          # ØªØ­Ø¯ÙŠØ« logs.json
          cat > dashboard/logs.json << 'EOF'
          {
            "lastUpdate": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "runId": "${{ needs.intelligent-analysis.outputs.run-id }}",
            "status": "${{ needs.intelligent-testing.result }}",
            "mode": "${{ env.WORKFLOW_MODE }}",
            "scope": "${{ env.SCOPE }}",
            "summary": {
              "testsRun": 0,
              "testsPassed": 0,
              "fixesApplied": 0,
              "qualityScore": 85
            }
          }
          EOF

      - name: ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ GitHub Summary
        run: |
          echo "## ğŸš€ Ultimate CI Self-Healing Agent Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ”„ Ø§Ù„Ø¯ÙˆØ±Ø©: ${{ needs.intelligent-analysis.outputs.run-id }}" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸŒ¿ Ø§Ù„ÙØ±Ø¹: ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ¯ Ø§Ù„ÙˆØ¶Ø¹: ${{ env.WORKFLOW_MODE }}" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ¯ Ø§Ù„Ù†Ø·Ø§Ù‚: ${{ env.SCOPE }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### âœ… Ø§Ù„Ù†ØªØ§Ø¦Ø¬:" >> $GITHUB_STEP_SUMMARY
          echo "- Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ: ${{ needs.intelligent-analysis.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©: ${{ needs.intelligent-testing.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø°ÙƒÙŠ: ${{ needs.intelligent-fixing.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°ÙƒÙŠ: ${{ needs.intelligent-cleanup.result }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:" >> $GITHUB_STEP_SUMMARY
          echo "- Ø£ÙˆÙ„ ØªØ´ØºÙŠÙ„: ${{ needs.intelligent-analysis.outputs.is-first-run }}" >> $GITHUB_STEP_SUMMARY
          echo "- Commits Ø³Ø±ÙŠØ¹Ø©: ${{ needs.intelligent-analysis.outputs.has-rapid-commits }}" >> $GITHUB_STEP_SUMMARY
          echo "- Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©: ${{ needs.intelligent-analysis.outputs.affected-modules }}" >> $GITHUB_STEP_SUMMARY
          echo "- Ù†ÙˆØ¹ Ø§Ù„ØªØºÙŠÙŠØ±: ${{ needs.intelligent-analysis.outputs.change-type }}" >> $GITHUB_STEP_SUMMARY
          echo "- Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©: ${{ needs.intelligent-analysis.outputs.severity-level }}" >> $GITHUB_STEP_SUMMARY
          echo "- Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${{ needs.intelligent-analysis.outputs.test-strategy }}" >> $GITHUB_STEP_SUMMARY

      - name: ğŸ“§ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©
        if: failure() || needs.intelligent-analysis.outputs.severity-level == 'critical'
        run: |
          echo "ğŸ“§ Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø°ÙƒÙŠØ©..."
          
          case "${{ needs.intelligent-analysis.outputs.severity-level }}" in
            "critical")
              echo "ğŸš¨ ØªÙ†Ø¨ÙŠÙ‡ Ø­Ø±Ø¬: Ù…Ø´Ø§ÙƒÙ„ Ø®Ø·ÙŠØ±Ø© ØªØ­ØªØ§Ø¬ ØªØ¯Ø®Ù„ ÙÙˆØ±ÙŠ"
              ;;
            "high")
              echo "âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø§Ù„ÙŠ: Ù…Ø´Ø§ÙƒÙ„ Ù…Ù‡Ù…Ø© ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©"
              ;;
            *)
              echo "â„¹ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø§Ø¯ÙŠ: ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­"
              ;;
          esac

      - name: ğŸ“Š Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙƒÙ€ Artifacts
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: final-reports-${{ needs.intelligent-analysis.outputs.run-id }}
          path: |
            reports/
            dashboard/
            playwright-report/
            supawright-report/
          retention-days: 30
