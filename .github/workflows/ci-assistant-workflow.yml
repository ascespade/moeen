name: ğŸ¤– CI Assistant Workflow - Error Resolver

on:
  workflow_run:
    workflows: ["ğŸš€ Master CI Workflow - Smart Testing & Auto-Healing"]
    types: [completed]
    branches: [main, develop, feature/*, hotfix/*]

permissions:
  contents: write
  pull-requests: write
  issues: write
  checks: write
  statuses: write
  actions: read

env:
  NODE_VERSION: '20'
  NPM_VERSION: '10'
  CI: true
  NODE_ENV: production
  CURSOR_API_KEY: ${{ secrets.CURSOR_API_KEY }}

jobs:
  # ğŸ” Job 1: Analyze Master Workflow Failure
  analyze-master-failure:
    if: github.event.workflow_run.conclusion == 'failure'
    runs-on: ubuntu-latest
    timeout-minutes: 15
    outputs:
      failure-reason: ${{ steps.analyze-failure.outputs.failure-reason }}
      error-logs: ${{ steps.analyze-failure.outputs.error-logs }}
      fix-required: ${{ steps.analyze-failure.outputs.fix-required }}
    
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: ğŸ“¦ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ¦Ø©
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¥ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        run: |
          npm ci
          npm install js-yaml sqlite3

      - name: ğŸ§  ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ù„Ù…
        run: |
          echo "ğŸ§  ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ù„Ù…..."
          node scripts/ci-learning-db.js init

      - name: ğŸ” ØªØ­Ù„ÙŠÙ„ ÙØ´Ù„ Master Workflow
        id: analyze-failure
        run: |
          echo "ğŸ” ØªØ­Ù„ÙŠÙ„ ÙØ´Ù„ Master Workflow..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„
          mkdir -p analysis/ logs/ learning/
          
          # ØªØ­Ù„ÙŠÙ„ Ø³Ø¨Ø¨ Ø§Ù„ÙØ´Ù„
          echo "ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø³Ø¨Ø¨ Ø§Ù„ÙØ´Ù„..."
          node -e "
            const fs = require('fs');
            
            // ØªØ­Ù„ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù€ workflow_run
            const workflowRun = process.env.GITHUB_EVENT_PATH ? 
              JSON.parse(fs.readFileSync(process.env.GITHUB_EVENT_PATH, 'utf8')).workflow_run : 
              null;
            
            let failureReason = 'Unknown failure';
            let errorLogs = '';
            let fixRequired = true;
            
            if (workflowRun) {
              failureReason = workflowRun.conclusion || 'Unknown';
              errorLogs = 'Workflow run ID: ' + workflowRun.id + '\\n';
              errorLogs += 'Status: ' + workflowRun.status + '\\n';
              errorLogs += 'Conclusion: ' + workflowRun.conclusion + '\\n';
              errorLogs += 'URL: ' + workflowRun.html_url + '\\n';
              
              // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù…Ù† Ø§Ù„Ù€ jobs
              if (workflowRun.jobs) {
                workflowRun.jobs.forEach(job => {
                  if (job.conclusion === 'failure') {
                    errorLogs += '\\nFailed Job: ' + job.name + '\\n';
                    errorLogs += 'Job ID: ' + job.id + '\\n';
                    errorLogs += 'Steps: ' + JSON.stringify(job.steps, null, 2) + '\\n';
                  }
                });
              }
            }
            
            // Ø­ÙØ¸ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ´Ù„
            const analysis = {
              failureReason,
              errorLogs,
              fixRequired,
              timestamp: new Date().toISOString(),
              workflowRunId: workflowRun ? workflowRun.id : null,
              repository: process.env.GITHUB_REPOSITORY,
              branch: process.env.GITHUB_REF_NAME
            };
            
            fs.writeFileSync('analysis/failure-analysis.json', JSON.stringify(analysis, null, 2));
            
            console.log('failure-reason=' + failureReason);
            console.log('error-logs=' + errorLogs.replace(/\\n/g, ' '));
            console.log('fix-required=' + fixRequired);
          "

      - name: ğŸ“Š Ø­ÙØ¸ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ´Ù„
        uses: actions/upload-artifact@v4
        with:
          name: failure-analysis
          path: analysis/
          retention-days: 7

  # ğŸ¤– Job 2: Send Error to Cursor API for Fix
  send-to-cursor-api:
    if: needs.analyze-master-failure.outputs.fix-required == 'true'
    needs: analyze-master-failure
    runs-on: ubuntu-latest
    timeout-minutes: 20
    outputs:
      cursor-response: ${{ steps.cursor-api.outputs.cursor-response }}
      fixes-received: ${{ steps.cursor-api.outputs.fixes-received }}
      fix-count: ${{ steps.cursor-api.outputs.fix-count }}
    
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: ğŸ“¦ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ¦Ø©
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¥ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        run: |
          npm ci
          npm install js-yaml sqlite3

      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ´Ù„
        uses: actions/download-artifact@v4
        with:
          name: failure-analysis
          path: analysis/

      - name: ğŸ¤– Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø®Ø·Ø£ Ù„Ù€ Cursor API
        id: cursor-api
        run: |
          echo "ğŸ¤– Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø®Ø·Ø£ Ù„Ù€ Cursor API Ù„Ù„Ø¥ØµÙ„Ø§Ø­..."
          
          # Ù‚Ø±Ø§Ø¡Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ´Ù„
          const analysis = JSON.parse(require('fs').readFileSync('analysis/failure-analysis.json', 'utf8'));
          
          # Ø¥Ø±Ø³Ø§Ù„ Ù„Ù€ Cursor API
          node -e "
            const https = require('https');
            const fs = require('fs');
            
            const analysis = JSON.parse(fs.readFileSync('analysis/failure-analysis.json', 'utf8'));
            
            const payload = {
              errorType: 'workflow_failure',
              failureReason: analysis.failureReason,
              errorLogs: analysis.errorLogs,
              context: {
                repository: process.env.GITHUB_REPOSITORY,
                branch: process.env.GITHUB_REF_NAME,
                commit: process.env.GITHUB_SHA,
                workflowRunId: analysis.workflowRunId,
                timestamp: analysis.timestamp
              },
              files: [
                '.github/workflows/',
                'scripts/',
                'package.json',
                'src/',
                'tests/'
              ],
              priority: 'high',
              requestType: 'workflow_fix'
            };
            
            const options = {
              hostname: 'api.cursor.sh',
              port: 443,
              path: '/v1/fix-workflow-error',
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + process.env.CURSOR_API_KEY,
                'X-Request-ID': 'assistant-' + Date.now()
              }
            };
            
            const req = https.request(options, (res) => {
              let data = '';
              res.on('data', (chunk) => data += chunk);
              res.on('end', () => {
                try {
                  const response = JSON.parse(data);
                  console.log('cursor-response=' + (response.success ? 'success' : 'failed'));
                  console.log('fixes-received=' + (response.fixes ? response.fixes.length : 0));
                  console.log('fix-count=' + (response.fixes ? response.fixes.length : 0));
                  
                  // Ø­ÙØ¸ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Cursor
                  fs.writeFileSync('analysis/cursor-response.json', JSON.stringify(response, null, 2));
                } catch (e) {
                  console.log('cursor-response=failed');
                  console.log('fixes-received=0');
                  console.log('fix-count=0');
                  
                  // Ø­ÙØ¸ Ø®Ø·Ø£ Ø§Ù„Ø§ØªØµØ§Ù„
                  fs.writeFileSync('analysis/cursor-error.json', JSON.stringify({
                    error: e.message,
                    timestamp: new Date().toISOString()
                  }, null, 2));
                }
              });
            });
            
            req.on('error', (e) => {
              console.log('cursor-response=failed');
              console.log('fixes-received=0');
              console.log('fix-count=0');
              
              // Ø­ÙØ¸ Ø®Ø·Ø£ Ø§Ù„Ø§ØªØµØ§Ù„
              fs.writeFileSync('analysis/cursor-error.json', JSON.stringify({
                error: e.message,
                timestamp: new Date().toISOString()
              }, null, 2));
            });
            
            req.write(JSON.stringify(payload));
            req.end();
          "

      - name: ğŸ“Š Ø­ÙØ¸ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Cursor
        uses: actions/upload-artifact@v4
        with:
          name: cursor-response
          path: analysis/
          retention-days: 7

  # ğŸ”§ Job 3: Apply Fixes from Cursor API
  apply-cursor-fixes:
    if: needs.send-to-cursor-api.outputs.fixes-received != '0'
    needs: [analyze-master-failure, send-to-cursor-api]
    runs-on: ubuntu-latest
    timeout-minutes: 25
    outputs:
      fixes-applied: ${{ steps.apply-fixes.outputs.fixes-applied }}
      success-count: ${{ steps.apply-fixes.outputs.success-count }}
      failure-count: ${{ steps.apply-fixes.outputs.failure-count }}
    
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: ğŸ“¦ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ¦Ø©
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¥ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        run: |
          npm ci
          npm install js-yaml sqlite3

      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Cursor
        uses: actions/download-artifact@v4
        with:
          name: cursor-response
          path: analysis/

      - name: ğŸ”§ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ù…Ù† Cursor API
        id: apply-fixes
        run: |
          echo "ğŸ”§ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ù…Ù† Cursor API..."
          
          if [ -f "analysis/cursor-response.json" ]; then
            node -e "
              const fs = require('fs');
              const response = JSON.parse(fs.readFileSync('analysis/cursor-response.json', 'utf8'));
              
              let fixesApplied = 0;
              let successCount = 0;
              let failureCount = 0;
              
              if (response.fixes && response.fixes.length > 0) {
                console.log('ğŸ”§ ØªØ·Ø¨ÙŠÙ‚ ' + response.fixes.length + ' Ø¥ØµÙ„Ø§Ø­ Ù…Ù† Cursor API...');
                
                response.fixes.forEach((fix, index) => {
                  try {
                    if (fix.file && fix.content) {
                      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ù„Ù Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                      const dir = fix.file.substring(0, fix.file.lastIndexOf('/'));
                      if (dir) {
                        fs.mkdirSync(dir, { recursive: true });
                      }
                      
                      // ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰
                      fs.writeFileSync(fix.file, fix.content);
                      console.log('âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­: ' + fix.file);
                      fixesApplied++;
                      successCount++;
                    } else {
                      console.log('âš ï¸ Ø¥ØµÙ„Ø§Ø­ ØºÙŠØ± ØµØ§Ù„Ø­: ' + JSON.stringify(fix));
                      failureCount++;
                    }
                  } catch (e) {
                    console.log('âŒ ÙØ´Ù„ ÙÙŠ Ø¥ØµÙ„Ø§Ø­: ' + fix.file + ' - ' + e.message);
                    failureCount++;
                  }
                });
              } else {
                console.log('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥ØµÙ„Ø§Ø­Ø§Øª ÙÙŠ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Cursor API');
              }
              
              console.log('fixes-applied=' + fixesApplied);
              console.log('success-count=' + successCount);
              console.log('failure-count=' + failureCount);
              
              // Ø­ÙØ¸ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ØµÙ„Ø§Ø­
              fs.writeFileSync('analysis/fix-report.json', JSON.stringify({
                fixesApplied,
                successCount,
                failureCount,
                timestamp: new Date().toISOString()
              }, null, 2));
            "
          else
            echo "âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù…Ù† Cursor API"
            echo "fixes-applied=0"
            echo "success-count=0"
            echo "failure-count=0"
          fi

      - name: ğŸ” ÙØ­Øµ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©
        run: |
          echo "ğŸ” ÙØ­Øµ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©..."
          
          # ÙØ­Øµ Ø§Ù„Ù€ workflows
          node scripts/validate-workflows.js > logs/post-fix-validation.log 2>&1
          
          # ÙØ­Øµ Ø§Ù„ÙƒÙˆØ¯
          npm run lint > logs/post-fix-lint.log 2>&1 || echo "Lint check completed"
          
          # ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
          node -e "
            const fs = require('fs');
            
            let validationErrors = 0;
            let lintErrors = 0;
            
            if (fs.existsSync('logs/post-fix-validation.log')) {
              const content = fs.readFileSync('logs/post-fix-validation.log', 'utf8');
              const errorMatches = content.match(/âŒ/g);
              validationErrors = errorMatches ? errorMatches.length : 0;
            }
            
            if (fs.existsSync('logs/post-fix-lint.log')) {
              const content = fs.readFileSync('logs/post-fix-lint.log', 'utf8');
              const errorMatches = content.match(/error/g);
              lintErrors = errorMatches ? errorMatches.length : 0;
            }
            
            console.log('Validation errors: ' + validationErrors);
            console.log('Lint errors: ' + lintErrors);
            
            // Ø­ÙØ¸ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ­Øµ
            fs.writeFileSync('analysis/validation-report.json', JSON.stringify({
              validationErrors,
              lintErrors,
              timestamp: new Date().toISOString()
            }, null, 2));
          "

      - name: ğŸ“Š Ø­ÙØ¸ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ØµÙ„Ø§Ø­
        uses: actions/upload-artifact@v4
        with:
          name: fix-application-report
          path: |
            analysis/
            logs/
          retention-days: 7

  # ğŸ’¾ Job 4: Commit and Push Fixes
  commit-and-push:
    if: needs.apply-cursor-fixes.outputs.fixes-applied != '0'
    needs: [analyze-master-failure, send-to-cursor-api, apply-cursor-fixes]
    runs-on: ubuntu-latest
    timeout-minutes: 10
    outputs:
      commit-hash: ${{ steps.commit.outputs.commit-hash }}
      push-success: ${{ steps.push.outputs.push-success }}
    
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ØµÙ„Ø§Ø­
        uses: actions/download-artifact@v4
        with:
          name: fix-application-report
          path: analysis/

      - name: ğŸ’¾ Ø¥Ù†Ø´Ø§Ø¡ Commit Ù„Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª
        id: commit
        run: |
          echo "ğŸ’¾ Ø¥Ù†Ø´Ø§Ø¡ Commit Ù„Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª..."
          
          # Ø¥Ø¹Ø¯Ø§Ø¯ Git
          git config --local user.email "ci-assistant@github.com"
          git config --local user.name "CI Assistant"
          
          # Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
          git add .
          
          # Ø¥Ù†Ø´Ø§Ø¡ commit
          git commit -m "ğŸ¤– CI Assistant: Ø¥ØµÙ„Ø§Ø­ ÙØ´Ù„ Master Workflow

ğŸ” Ø³Ø¨Ø¨ Ø§Ù„ÙØ´Ù„: ${{ needs.analyze-master-failure.outputs.failure-reason }}
ğŸ”§ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©: ${{ needs.apply-cursor-fixes.outputs.fixes-applied }}
âœ… Ù†Ø¬Ø­: ${{ needs.apply-cursor-fixes.outputs.success-count }}
âŒ ÙØ´Ù„: ${{ needs.apply-cursor-fixes.outputs.failure-count }}

ğŸ¤– ØªÙ… Ø¨ÙˆØ§Ø³Ø·Ø©: CI Assistant
ğŸ”„ Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Master Workflow Ù…Ø±Ø© Ø£Ø®Ø±Ù‰" || echo "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª Ù„Ù„Ø­ÙØ¸"
          
          # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ hash Ø§Ù„Ù€ commit
          COMMIT_HASH=$(git rev-parse HEAD)
          echo "commit-hash=$COMMIT_HASH"

      - name: ğŸ“¤ Ø±ÙØ¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª
        id: push
        run: |
          echo "ğŸ“¤ Ø±ÙØ¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª..."
          
          # Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
          if git push origin ${{ github.ref_name }}; then
            echo "push-success=true"
            echo "âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø¨Ù†Ø¬Ø§Ø­"
          else
            echo "push-success=false"
            echo "âŒ ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª"
            exit 1
          fi

  # ğŸ“Š Job 5: Generate Assistant Report
  generate-assistant-report:
    if: always()
    needs: [analyze-master-failure, send-to-cursor-api, apply-cursor-fixes, commit-and-push]
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
        uses: actions/download-artifact@v4
        with:
          name: fix-application-report
          path: analysis/

      - name: ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± CI Assistant
        run: |
          echo "ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± CI Assistant..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
          cat > CI_ASSISTANT_REPORT.md << 'EOF'
          # ğŸ¤– CI Assistant Workflow - Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
          
          ## ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°
          - **Ø§Ù„ØªØ§Ø±ÙŠØ®:** $(date)
          - **Ø§Ù„ÙØ±Ø¹:** ${{ github.ref_name }}
          - **Ø§Ù„ÙƒÙˆÙ…ÙŠØª:** ${{ github.sha }}
          - **Ø§Ù„Ù…Ø´ØºÙ„:** ${{ github.actor }}
          
          ## ğŸ” ØªØ­Ù„ÙŠÙ„ ÙØ´Ù„ Master Workflow
          - **Ø³Ø¨Ø¨ Ø§Ù„ÙØ´Ù„:** ${{ needs.analyze-master-failure.outputs.failure-reason }}
          - **Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­:** ${{ needs.analyze-master-failure.outputs.fix-required }}
          
          ## ğŸ¤– ØªÙØ§Ø¹Ù„ Cursor API
          - **Ø§Ø³ØªØ¬Ø§Ø¨Ø© Cursor:** ${{ needs.send-to-cursor-api.outputs.cursor-response }}
          - **Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:** ${{ needs.send-to-cursor-api.outputs.fixes-received }}
          
          ## ğŸ”§ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª
          - **Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©:** ${{ needs.apply-cursor-fixes.outputs.fixes-applied }}
          - **Ù†Ø¬Ø­:** ${{ needs.apply-cursor-fixes.outputs.success-count }}
          - **ÙØ´Ù„:** ${{ needs.apply-cursor-fixes.outputs.failure-count }}
          
          ## ğŸ’¾ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
          - **Commit Hash:** ${{ needs.commit-and-push.outputs.commit-hash }}
          - **Ø±ÙØ¹ Ù†Ø§Ø¬Ø­:** ${{ needs.commit-and-push.outputs.push-success }}
          
          ## âœ… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
          EOF
          
          # Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„
          if [ -f "analysis/fix-report.json" ]; then
            node -e "
              const fs = require('fs');
              const report = JSON.parse(fs.readFileSync('analysis/fix-report.json', 'utf8'));
              
              const details = \`
          ### ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
          - **Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª:** \${report.fixesApplied}
          - **Ù†Ø¬Ø­:** \${report.successCount}
          - **ÙØ´Ù„:** \${report.failureCount}
          - **Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­:** \${report.fixesApplied > 0 ? (report.successCount / report.fixesApplied * 100).toFixed(2) : 0}%
          
          ### ğŸ¯ Ø§Ù„ØªÙˆØµÙŠØ§Øª
          \${report.failureCount > 0 ? 'âš ï¸ Ø¨Ø¹Ø¶ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª ÙØ´Ù„Øª - ÙŠØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©' : 'âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ù†Ø¬Ø­Øª'}
          \${report.successCount > 0 ? 'âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© - Master Workflow Ø³ÙŠØ¹Ù…Ù„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰' : 'âŒ Ù„Ù… ÙŠØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©'}
          
          ### ğŸš€ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©
          1. Master Workflow Ø³ÙŠØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
          2. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
          3. ØªØ­Ø³ÙŠÙ† Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
          \`;
              
              fs.appendFileSync('CI_ASSISTANT_REPORT.md', details);
            "
          fi

      - name: ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        run: |
          echo "ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±..."
          
          # Ø¥Ø¹Ø¯Ø§Ø¯ Git
          git config --local user.email "ci-assistant@github.com"
          git config --local user.name "CI Assistant"
          
          # Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
          git add CI_ASSISTANT_REPORT.md
          
          # Ø¥Ù†Ø´Ø§Ø¡ commit Ù„Ù„ØªÙ‚Ø±ÙŠØ±
          git commit -m "ğŸ“Š CI Assistant Report - $(date '+%Y-%m-%d %H:%M:%S')

ğŸ” Ø³Ø¨Ø¨ Ø§Ù„ÙØ´Ù„: ${{ needs.analyze-master-failure.outputs.failure-reason }}
ğŸ”§ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª: ${{ needs.apply-cursor-fixes.outputs.fixes-applied }}
âœ… Ø§Ù„Ù†Ø¬Ø§Ø­: ${{ needs.apply-cursor-fixes.outputs.success-count }}

ğŸ¤– ØªÙ… Ø¨ÙˆØ§Ø³Ø·Ø©: CI Assistant" || echo "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª Ù„Ù„Ø­ÙØ¸"

      - name: ğŸ“¤ Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        run: |
          echo "ğŸ“¤ Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±..."
          git push origin ${{ github.ref_name }} || echo "ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±"

      - name: ğŸ“Š Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙƒÙ€ Artifact
        uses: actions/upload-artifact@v4
        with:
          name: ci-assistant-final-report
          path: CI_ASSISTANT_REPORT.md
          retention-days: 30