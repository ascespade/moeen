# ๐ก๏ธ Tailscale Guardian Script

ุณูุฑุจุช ุฐูู ููุฑุงูุจุฉ ูุฅุฏุงุฑุฉ ุงุชุตุงู Tailscale ุชููุงุฆูุงู.

## โจ ุงููููุฒุงุช

- โ ูุชุฃูุฏ ูู ุชุดุบูู ุฎุฏูุฉ `tailscaled`
- โ ูุดุบู `tailscaled` ุชููุงุฆูุงู ุฅุฐุง ุชููู
- โ ูุดุบู `tailscale up` ุชููุงุฆูุงู ุฅุฐุง ุงููุทุน ุงูุงุชุตุงู
- โ ูุนูู ูู ุงูุฎูููุฉ ุญุชู ูู ุฃุบููุช ุงูุชูุฑููุงู
- โ ูุนูุฏ ุงููุญุงููุฉ ูู ุฏูููุฉ ุชููุงุฆูุงู
- โ ูุณุฌู ุฌููุน ุงูุนูููุงุช ูู ููู ุงูููู
- โ ูุนุงูุฌุฉ ูุธููุฉ ููุฅุดุงุฑุงุช (SIGTERM, SIGINT)

## ๐ ุงูุชุซุจูุช

### 1. ุฅุนุฏุงุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ

ูุจู ุชุดุบูู ุงูุณูุฑุจุชุ ุชุญุชุงุฌ ูุชุนุฏูู ุงููุชุบูุฑุงุช ุงูุชุงููุฉ:

```bash
sudo nano /usr/local/bin/tailscale-guardian.sh
```

ุบููุฑ ูุฐู ุงูููู:
- `AUTH_KEY`: ููุชุงุญ ุงูุชูุซูู ูู Tailscale Admin Console
- `HOSTNAME`: ุงุณู ุงูุฌูุงุฒ ูู ุดุจูุฉ Tailscale

### 2. ุชุดุบูู ุงูุณูุฑุจุช

```bash
# ุชุดุบูู ูู ุงูุฎูููุฉ
nohup /usr/local/bin/tailscale-guardian.sh > /dev/null 2>&1 &

# ุฃู ุชุดุบูู ูุจุงุดุฑ (ูููุฑุงูุจุฉ)
/usr/local/bin/tailscale-guardian.sh
```

### 3. ุชุดุบูู ุชููุงุฆู ุนูุฏ ุงูุฅููุงุน

```bash
# ูุชุญ crontab
crontab -e

# ุฅุถุงูุฉ ุงูุณุทุฑ ุงูุชุงูู
@reboot nohup /usr/local/bin/tailscale-guardian.sh > /dev/null 2>&1 &
```

## ๐ ุงููุฑุงูุจุฉ

### ุนุฑุถ ุงูููู
```bash
# ุนุฑุถ ุขุฎุฑ 50 ุณุทุฑ
tail -50 /var/log/tailscale-guardian.log

# ูุฑุงูุจุฉ ุงูููู ูุจุงุดุฑุฉ
tail -f /var/log/tailscale-guardian.log
```

### ูุญุต ุญุงูุฉ ุงูุณูุฑุจุช
```bash
# ูุญุต ุฅุฐุง ูุงู ุงูุณูุฑุจุช ูุนูู
pgrep -f tailscale-guardian

# ุนุฑุถ ูุนูููุงุช ุงูุนูููุฉ
ps aux | grep tailscale-guardian
```

### ูุญุต ุญุงูุฉ Tailscale
```bash
# ุญุงูุฉ ุงูุงุชุตุงู
tailscale status

# ูุนูููุงุช ุงูุดุจูุฉ
tailscale netcheck
```

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ุฅุนุงุฏุฉ ุงูุชุดุบูู ุงูุชููุงุฆู
```bash
# ุฅููุงู tailscaled ูุฏููุงู
sudo pkill tailscaled

# ุงูุณูุฑุจุช ุณูุนูุฏ ุชุดุบููู ุฎูุงู ุฏูููุฉ
```

### ุงุฎุชุจุงุฑ ุฅุนุงุฏุฉ ุงูุงุชุตุงู
```bash
# ุฅููุงู ุงูุงุชุตุงู
tailscale down

# ุงูุณูุฑุจุช ุณูุนูุฏ ุงูุงุชุตุงู ุชููุงุฆูุงู
```

## ๐ ุงูุฅููุงู

```bash
# ุฅููุงู ุงูุณูุฑุจุช
sudo pkill -f tailscale-guardian

# ุฃู ุฅููุงู ูุธูู
sudo kill -TERM $(pgrep -f tailscale-guardian)
```

## ๐ ุงููููุงุช

- **ุงูุณูุฑุจุช**: `/usr/local/bin/tailscale-guardian.sh`
- **ุงูููู**: `/var/log/tailscale-guardian.log`
- **ุญุงูุฉ Tailscale**: `/var/lib/tailscale/tailscaled.state`
- **Socket**: `/var/run/tailscale/tailscaled.sock`

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู ุดุงุฆุนุฉ

1. **ุฎุทุฃ ูู ุงูุตูุงุญูุงุช**:
   ```bash
   sudo chmod +x /usr/local/bin/tailscale-guardian.sh
   ```

2. **ูุฌูุฏุงุช ุบูุฑ ููุฌูุฏุฉ**:
   ```bash
   sudo mkdir -p /var/lib/tailscale /var/run/tailscale
   ```

3. **ูุดููุฉ ูู AUTH_KEY**:
   - ุชุฃูุฏ ูู ุตุญุฉ ุงูููุชุงุญ
   - ุชุฃูุฏ ูู ุฃู ุงูููุชุงุญ ูู ููุชู ุตูุงุญูุชู
   - ุชุฃูุฏ ูู ุฃู ุงูููุชุงุญ ูู ุตูุงุญูุงุช ูุงููุฉ

4. **ูุดููุฉ ูู ุงูุงุชุตุงู**:
   ```bash
   # ูุญุต ุฅุนุฏุงุฏุงุช ุงูุดุจูุฉ
   tailscale netcheck
   
   # ูุญุต ุญุงูุฉ ุงูุฎุฏูุฉ
   systemctl status tailscaled
   ```

## ๐ ููุงุญุธุงุช ูููุฉ

- ุชุฃูุฏ ูู ุชุซุจูุช Tailscale ูุจู ุชุดุบูู ุงูุณูุฑุจุช
- ุงูุณูุฑุจุช ูุญุชุงุฌ ุตูุงุญูุงุช root ูููุตูู ููููุงุช ุงููุธุงู
- ูููู ุชุฎุตูุต ูุชุฑุฉ ุงููุญุต ุจุชุบููุฑ ูููุฉ `sleep 60`
- ุงูุณูุฑุจุช ุขูู ููุชุดุบูู ุนูู ุฎูุงุฏู ุงูุฅูุชุงุฌ

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ูุดุงูู:
1. ุฑุงุฌุน ููู ุงูููู: `/var/log/tailscale-guardian.log`
2. ุชุฃูุฏ ูู ุฅุนุฏุงุฏุงุช AUTH_KEY ู HOSTNAME
3. ุชุฃูุฏ ูู ุชุซุจูุช Tailscale ุจุดูู ุตุญูุญ
