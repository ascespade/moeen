# ðŸ›¡ï¸ Tailscale Guardian Script

Ø³ÙƒØ±Ø¨Øª Ø°ÙƒÙŠ Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§ØªØµØ§Ù„ Tailscale ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.

## âœ¨ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª

- âœ… ÙŠØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø®Ø¯Ù…Ø© `tailscaled`
- âœ… ÙŠØ´ØºÙ„ `tailscaled` ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ØªÙˆÙ‚Ù
- âœ… ÙŠØ´ØºÙ„ `tailscale up` ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„
- âœ… ÙŠØ¹Ù…Ù„ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø­ØªÙ‰ Ù„Ùˆ Ø£ØºÙ„Ù‚Øª Ø§Ù„ØªÙŠØ±Ù…Ù†Ø§Ù„
- âœ… ÙŠØ¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
- âœ… ÙŠØ³Ø¬Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙÙŠ Ù…Ù„Ù Ø§Ù„Ù„ÙˆÙ‚
- âœ… Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†Ø¸ÙŠÙØ© Ù„Ù„Ø¥Ø´Ø§Ø±Ø§Øª (SIGTERM, SIGINT)

## ðŸš€ Ø§Ù„ØªØ«Ø¨ÙŠØª

### 1. Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©

Ù‚Ø¨Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨ØªØŒ ØªØ­ØªØ§Ø¬ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:

```bash
sudo nano /usr/local/bin/tailscale-guardian.sh
```

ØºÙŠÙ‘Ø± Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ…:

- `AUTH_KEY`: Ù…ÙØªØ§Ø­ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ù…Ù† Tailscale Admin Console
- `HOSTNAME`: Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² ÙÙŠ Ø´Ø¨ÙƒØ© Tailscale

### 2. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª

```bash
# ØªØ´ØºÙŠÙ„ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
nohup /usr/local/bin/tailscale-guardian.sh > /dev/null 2>&1 &

# Ø£Ùˆ ØªØ´ØºÙŠÙ„ Ù…Ø¨Ø§Ø´Ø± (Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©)
/usr/local/bin/tailscale-guardian.sh
```

### 3. ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹

```bash
# ÙØªØ­ crontab
crontab -e

# Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠ
@reboot nohup /usr/local/bin/tailscale-guardian.sh > /dev/null 2>&1 &
```

## ðŸ“Š Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©

### Ø¹Ø±Ø¶ Ø§Ù„Ù„ÙˆÙ‚

```bash
# Ø¹Ø±Ø¶ Ø¢Ø®Ø± 50 Ø³Ø·Ø±
tail -50 /var/log/tailscale-guardian.log

# Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù„ÙˆÙ‚ Ù…Ø¨Ø§Ø´Ø±Ø©
tail -f /var/log/tailscale-guardian.log
```

### ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙƒØ±Ø¨Øª

```bash
# ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙŠØ¹Ù…Ù„
pgrep -f tailscale-guardian

# Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
ps aux | grep tailscale-guardian
```

### ÙØ­Øµ Ø­Ø§Ù„Ø© Tailscale

```bash
# Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
tailscale status

# Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©
tailscale netcheck
```

## ðŸ§ª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±

### Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ

```bash
# Ø¥ÙŠÙ‚Ø§Ù tailscaled ÙŠØ¯ÙˆÙŠØ§Ù‹
sudo pkill tailscaled

# Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø³ÙŠØ¹ÙŠØ¯ ØªØ´ØºÙŠÙ„Ù‡ Ø®Ù„Ø§Ù„ Ø¯Ù‚ÙŠÙ‚Ø©
```

### Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„

```bash
# Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§ØªØµØ§Ù„
tailscale down

# Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø³ÙŠØ¹ÙŠØ¯ Ø§Ù„Ø§ØªØµØ§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
```

## ðŸ›‘ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù

```bash
# Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø³ÙƒØ±Ø¨Øª
sudo pkill -f tailscale-guardian

# Ø£Ùˆ Ø¥ÙŠÙ‚Ø§Ù Ù†Ø¸ÙŠÙ
sudo kill -TERM $(pgrep -f tailscale-guardian)
```

## ðŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª

- **Ø§Ù„Ø³ÙƒØ±Ø¨Øª**: `/usr/local/bin/tailscale-guardian.sh`
- **Ø§Ù„Ù„ÙˆÙ‚**: `/var/log/tailscale-guardian.log`
- **Ø­Ø§Ù„Ø© Tailscale**: `/var/lib/tailscale/tailscaled.state`
- **Socket**: `/var/run/tailscale/tailscaled.sock`

## ðŸ”§ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

### Ù…Ø´Ø§ÙƒÙ„ Ø´Ø§Ø¦Ø¹Ø©

1. **Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª**:

   ```bash
   sudo chmod +x /usr/local/bin/tailscale-guardian.sh
   ```

2. **Ù…Ø¬Ù„Ø¯Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©**:

   ```bash
   sudo mkdir -p /var/lib/tailscale /var/run/tailscale
   ```

3. **Ù…Ø´ÙƒÙ„Ø© ÙÙŠ AUTH_KEY**:
   - ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…ÙØªØ§Ø­
   - ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…ÙØªØ§Ø­ Ù„Ù… ÙŠÙ†ØªÙ‡ ØµÙ„Ø§Ø­ÙŠØªÙ‡
   - ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…ÙØªØ§Ø­ Ù„Ù‡ ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§ÙÙŠØ©

4. **Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„**:

   ```bash
   # ÙØ­Øµ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©
   tailscale netcheck

   # ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø¯Ù…Ø©
   systemctl status tailscaled
   ```

## ðŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©

- ØªØ£ÙƒØ¯ Ù…Ù† ØªØ«Ø¨ÙŠØª Tailscale Ù‚Ø¨Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª
- Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙŠØ­ØªØ§Ø¬ ØµÙ„Ø§Ø­ÙŠØ§Øª root Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
- ÙŠÙ…ÙƒÙ† ØªØ®ØµÙŠØµ ÙØªØ±Ø© Ø§Ù„ÙØ­Øµ Ø¨ØªØºÙŠÙŠØ± Ù‚ÙŠÙ…Ø© `sleep 60`
- Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø¢Ù…Ù† Ù„Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù„Ù‰ Ø®ÙˆØ§Ø¯Ù… Ø§Ù„Ø¥Ù†ØªØ§Ø¬

## ðŸ†˜ Ø§Ù„Ø¯Ø¹Ù…

Ø¥Ø°Ø§ ÙˆØ§Ø¬Ù‡Øª Ù…Ø´Ø§ÙƒÙ„:

1. Ø±Ø§Ø¬Ø¹ Ù…Ù„Ù Ø§Ù„Ù„ÙˆÙ‚: `/var/log/tailscale-guardian.log`
2. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª AUTH_KEY Ùˆ HOSTNAME
3. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ«Ø¨ÙŠØª Tailscale Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­

nohup /usr/local/bin/tailscale-guardian-advanced.sh > /dev/null 2>&1 &
sleep 5 && pgrep -f tailscale-guardian
tail -10 /var/log/tailscale-guardian.log
