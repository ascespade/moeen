# 🔧 دليل مراقبة موارد الخادم

## الأدوات المتاحة

### 1. **الأدوات المدمجة في النظام**

```bash
# مراقبة تفاعلية
htop                    # واجهة جميلة لمراقبة العمليات
top                     # مراقبة العمليات التقليدية

# مراقبة الذاكرة
free -h                 # استخدام الذاكرة
vmstat 1 5              # إحصائيات الذاكرة كل ثانية

# مراقبة القرص
df -h                   # مساحة القرص
du -h /path             # حجم المجلدات
iotop                   # نشاط القرص (يحتاج تثبيت)

# مراقبة الشبكة
netstat -tuln           # الاتصالات النشطة
ss -tuln                # بديل محسن لـ netstat
iftop                   # حركة الشبكة (يحتاج تثبيت)
```

### 2. **السكريبتات المخصصة**

#### أ) **المراقبة السريعة**
```bash
./quick_monitor.sh
```
- يعرض ملخص سريع للموارد
- مناسب للفحص السريع

#### ب) **المراقبة الشاملة**
```bash
./monitor_resources.sh
```
- مراقبة شاملة لجميع الموارد
- عرض تفصيلي مع ألوان
- تحقق من الإنذارات

#### ج) **المراقبة المستمرة**
```bash
./continuous_monitor.sh
```
- مراقبة مستمرة مع تسجيل البيانات
- حفظ البيانات في ملف السجل
- عرض إحصائيات في الوقت الفعلي

#### د) **تحليل البيانات**
```bash
./analyze_logs.sh
```
- تحليل البيانات المحفوظة
- إحصائيات مفصلة
- تحليل الإنذارات

## 🚀 طرق الاستخدام

### المراقبة الفورية
```bash
# فحص سريع
./quick_monitor.sh

# مراقبة تفاعلية
htop

# مراقبة المعالج فقط
./monitor_resources.sh cpu

# مراقبة الذاكرة فقط
./monitor_resources.sh mem
```

### المراقبة المستمرة
```bash
# بدء المراقبة المستمرة
./continuous_monitor.sh

# في terminal منفصل، تحليل البيانات
./analyze_logs.sh
```

### المراقبة المتقدمة
```bash
# مراقبة كل 10 ثوان
watch -n 10 './quick_monitor.sh'

# مراقبة مع تسجيل
./continuous_monitor.sh > monitoring.log 2>&1 &
```

## 📊 فهم النتائج

### استخدام المعالج
- **0-30%**: طبيعي
- **30-70%**: متوسط
- **70-90%**: عالي
- **90%+**: حرج

### استخدام الذاكرة
- **0-50%**: طبيعي
- **50-80%**: متوسط
- **80-95%**: عالي
- **95%+**: حرج

### استخدام القرص
- **0-70%**: طبيعي
- **70-85%**: متوسط
- **85-95%**: عالي
- **95%+**: حرج

## ⚠️ الإنذارات

السكريبتات تتحقق تلقائياً من:
- استخدام المعالج > 80%
- استخدام الذاكرة > 80%
- استخدام القرص > 80%

## 🔧 نصائح إضافية

### تثبيت أدوات إضافية
```bash
# أدوات مراقبة الشبكة والقرص
sudo apt update
sudo apt install iotop nethogs iftop

# أدوات مراقبة متقدمة
sudo apt install sysstat
```

### مراقبة الخدمات
```bash
# حالة الخدمات
systemctl status

# مراقبة خدمة محددة
systemctl status nginx
journalctl -u nginx -f
```

### مراقبة السجلات
```bash
# سجلات النظام
tail -f /var/log/syslog

# سجلات التطبيقات
tail -f /var/log/nginx/access.log
```

## 📈 تحسين الأداء

### عند ارتفاع استخدام المعالج
```bash
# معرفة العمليات الأكثر استهلاكاً
ps aux --sort=-%cpu | head -10

# إنهاء عملية معينة
kill -9 PID
```

### عند ارتفاع استخدام الذاكرة
```bash
# معرفة العمليات الأكثر استهلاكاً للذاكرة
ps aux --sort=-%mem | head -10

# تنظيف الذاكرة المؤقتة
sync && echo 3 > /proc/sys/vm/drop_caches
```

### عند امتلاء القرص
```bash
# معرفة أكبر المجلدات
du -h / | sort -hr | head -10

# تنظيف الملفات المؤقتة
sudo apt autoremove
sudo apt autoclean
```

## 🎯 المراقبة الآلية

### إعداد cron job للمراقبة
```bash
# إضافة إلى crontab
crontab -e

# مراقبة كل 5 دقائق
*/5 * * * * /home/ubuntu/moeen/quick_monitor.sh >> /home/ubuntu/moeen/cron_monitor.log
```

### إعداد تنبيهات
```bash
# إرسال تنبيه عند ارتفاع الاستخدام
if [ $(df / | tail -1 | awk '{print $5}' | sed 's/%//') -gt 80 ]; then
    echo "تحذير: استخدام القرص عالي" | mail -s "تنبيه الخادم" admin@example.com
fi
```
